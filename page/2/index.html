<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="llz's blog" type="application/atom+xml" />






<meta property="og:type" content="website">
<meta property="og:title" content="llz&#39;s blog">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;page&#x2F;2&#x2F;index.html">
<meta property="og:site_name" content="llz&#39;s blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>llz's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>


    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">llz's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" target="_blank" rel="noopener" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/24/java/activemq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="llz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="llz's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/24/java/activemq/" itemprop="url">ActiveMQ学习记录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-24T16:40:05+08:00">
                2018-12-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/ActiveMQ/" itemprop="url" rel="index">
                    <span itemprop="name">ActiveMQ</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="JMS消息模型"><a href="#JMS消息模型" class="headerlink" title="JMS消息模型"></a>JMS消息模型</h1><h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><h3 id="Destination"><a href="#Destination" class="headerlink" title="Destination"></a>Destination</h3><ul>
<li>目的地，JMS Provider(消息中间件)负责维护，用于对Message进行管理的对象</li>
<li>MessageProducer需要指定Destination才能发送消息</li>
<li>MessageConsumer需要指定Destination才能接收消息</li>
</ul>
<h3 id="Producer"><a href="#Producer" class="headerlink" title="Producer"></a>Producer</h3><p>消息生产者(客户端，生成消息)，负责发送Message到Destination，应用接口为MessageProducer</p>
<h3 id="Consumer-Receiver"><a href="#Consumer-Receiver" class="headerlink" title="Consumer(Receiver)"></a>Consumer(Receiver)</h3><p>消息消费者,负责从目的地中消费【处理|监听|订阅】Message，应用接口为MessageConsumer</p>
<h3 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h3><p>消息，消息封装一次通信的内容，常见类型：StreamMessage,BytesMessage,TextMessage,ObjectMessage,MapMessage,传输时得实现Serializable接口</p>
<h3 id="ConnectionFactory"><a href="#ConnectionFactory" class="headerlink" title="ConnectionFactory"></a>ConnectionFactory</h3><p>连接工厂，用于创建连接的工厂类型</p>
<h3 id="Connection"><a href="#Connection" class="headerlink" title="Connection"></a>Connection</h3><p>连接，用于建立访问ActiveMQ连接的类型，由连接工厂创建</p>
<h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>会话，一次持久有效有状态的访问，由连接创建</p>
<h3 id="Queue-amp-Topic"><a href="#Queue-amp-Topic" class="headerlink" title="Queue &amp; Topic"></a>Queue &amp; Topic</h3><ul>
<li>Queue是队列目的地,队列中的消息，默认只能由唯一的一个消费者处理，一旦处理后消息删除</li>
<li>Topic是主题目的地，主题中的消息，会发送给所有的消费者同时处理，只有在消息可以重复处理的业务场景中可使用</li>
<li>Queue和Topic都是Destination的子接口</li>
</ul>
<h2 id="JMS消息确认机制"><a href="#JMS消息确认机制" class="headerlink" title="JMS消息确认机制"></a>JMS消息确认机制</h2><p>在session接口中定义几个常量：</p>
<ul>
<li>AUTO_ACKNOWLEDGE = 1  自动确认，常用，商业开发不推荐</li>
<li>CLIENT_ACKNOWLEDGE = 2    客户端手动确认</li>
<li>DUPS_OK_ACKNOWLEDGE = 3   一个消息可以多次处理，可以降低session消耗，在可以容忍重复消息时使用，不推荐使用</li>
<li>SESSION_TRANSACTED = 0    事务提交并确认</li>
</ul>
<h2 id="activemqAPI"><a href="#activemqAPI" class="headerlink" title="activemqAPI"></a>activemqAPI</h2><h3 id="activemq作用"><a href="#activemq作用" class="headerlink" title="activemq作用"></a>activemq作用</h3><ol>
<li>同步转异步</li>
<li>分流</li>
</ol>
<h3 id="ProducerAPI"><a href="#ProducerAPI" class="headerlink" title="ProducerAPI"></a>ProducerAPI</h3><h4 id="发送消息"><a href="#发送消息" class="headerlink" title="发送消息"></a>发送消息</h4><blockquote>
<p>MessageProducer.send(Message message);  </p>
</blockquote>
<p>发送消息到默认目的地(创建Producer时指定的目的地)</p>
<blockquote>
<p>   send(Destination destination,Message message);     </p>
</blockquote>
<p>发送消息到指定目的地，Producer不建议绑定目的地，即创建Producer时使用如下写法：<code>session.createProducer(null)</code></p>
<blockquote>
<p>   send(Message message,int deliveryMode,int priority,long timeToLive);    </p>
</blockquote>
<p>发送消息到默认目的地，且设置相关参数</p>
<ul>
<li>deliveryMode：持久化方式，取值<ul>
<li>DeliveryMode.PERSISTENT(持久化) ，消息会持久化到数据库(kahadb,JDBC等)</li>
<li>DeliveryMode.NON_PERSISTENT(不持久化)，消息只保存到内存中</li>
</ul>
</li>
<li>priority：优先级，0-9，取值越大优先级越高，不保证绝对顺序</li>
<li>timeToLive：消息有效期，单位ms，过期后会将失效消息保存到死信队列(ActiveMQ_DLQ),不持久化的数据超时后直接丢弃，不保存到死信队列，死信队列中的消息不能恢复</li>
</ul>
<blockquote>
<p>   send(Destinnation destination,Message message,int deliveryMode,int priority,long timeToLive);</p>
</blockquote>
<p>发送消息到指定目的地，且设置相关参数</p>
<h3 id="ConsumerAPI"><a href="#ConsumerAPI" class="headerlink" title="ConsumerAPI"></a>ConsumerAPI</h3><h4 id="消息确认"><a href="#消息确认" class="headerlink" title="消息确认"></a>消息确认</h4><ul>
<li>Consumer拉取消息后，如果没有确认<code>acknowledge()</code>，此消息不会从mq中删除，如果有其他新的consumer访问mq，会拉取到重复的消息</li>
<li>消息如果被拉去到consumer后，未确认，那么消息被锁定，如果consumer关闭的时候仍旧没有确认消息，则释放消息锁定信息，消息将发送给其他consumer处理</li>
<li>消息一旦处理，必须确认，类似数据库中的事务管理机制</li>
</ul>
<h2 id="P2P点对点模型"><a href="#P2P点对点模型" class="headerlink" title="P2P点对点模型"></a>P2P点对点模型</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><ul>
<li>P2P是基于Queue实现的消息处理方式</li>
<li>每个消息都被发送到Queue中，消费者从Queue中获取消息并消费</li>
<li>消息被消费后，Queue中不再有存储，所以消息消费者不可能消费到已经被消费的消息</li>
<li>Queue支持存在多个消费者，但对一个消息而言，只会有一个消费者可以消费，其他消费者不能消费此消息了</li>
<li>当消费者不存在时，消息会一直保存，直到有消费者来消费</li>
</ul>
<p>==如果希望发送的每个消息都会被成功处理，需要使用P2P模式==</p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li>每个消息只有一个消费者(Consumer)，即一旦被消费，消息就不再在消息队列中</li>
<li>发送者和接收者之间在时间上没有依赖性，即当发送者发送消息后，不管接收者有没有在运行，它不会影响消息被发送到队列</li>
<li>接收者在成功接收消息后需向队列应答成功</li>
</ul>
<h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//消息的发送方-------生产者</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">    <span class="comment">/**创建连接工厂对象</span></span><br><span class="line"><span class="comment">     * 创建工厂构造方法有3个参数，分别为用户名，密码，连接地址</span></span><br><span class="line"><span class="comment">     * 无参构造：有默认的连接地址，本地连接</span></span><br><span class="line"><span class="comment">     * 一个参数(连接地址)的构造：无验证模式的，没有用户认证</span></span><br><span class="line"><span class="comment">     * 三个参数的构造：有认证+指定地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ConnectionFactory connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(<span class="string">"tcp://localhost:61616"</span>);</span><br><span class="line">    <span class="comment">//从工厂中获取一个连接对象</span></span><br><span class="line">    Connection connection = connectionFactory.createConnection();</span><br><span class="line">    <span class="comment">/**建议启动连接，生产者不是必须启动连接，但消费者必须启动连接</span></span><br><span class="line"><span class="comment">     * 生产者在发送消息的时候，会检查是否启动了连接，如果未启动，会自动启动</span></span><br><span class="line"><span class="comment">     * 如果有特殊的配置，建议配置完毕后再启动连接</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    connection.start();</span><br><span class="line">    <span class="comment">/**获得session对象</span></span><br><span class="line"><span class="comment">     * 第一个参数transacted：是否支持事务</span></span><br><span class="line"><span class="comment">     *      true：支持事务，第二个参数对生产者默认无效，建议设为Session.SESSION_TRANSACTED</span></span><br><span class="line"><span class="comment">     *      false：不支持事务，第二个参数必须传递且有效</span></span><br><span class="line"><span class="comment">     * 第二个参数acknowledgeMode：如何确认消息的处理</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Session session = connection.createSession(<span class="keyword">false</span>,Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">    <span class="comment">//创建目的地，参数是目的地名称，是目的地的唯一标记</span></span><br><span class="line">    Destination destination = session.createQueue(<span class="string">"dest"</span>);</span><br><span class="line">    <span class="comment">//通过session对象创建消息的发送者</span></span><br><span class="line">    MessageProducer messageProducer = session.createProducer(destination);</span><br><span class="line">    <span class="comment">//通过sesion对象创建消息对象</span></span><br><span class="line">    TextMessage textMessage = session.createTextMessage(<span class="string">"测试的文本消息"</span>);</span><br><span class="line">    <span class="comment">//通过发送者发送消息</span></span><br><span class="line">    messageProducer.send(textMessage);</span><br><span class="line">    <span class="comment">//关闭资源</span></span><br><span class="line">    messageProducer.close();</span><br><span class="line">    session.close();</span><br><span class="line">    connection.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//消息的接收方-----消费者</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">    <span class="comment">//创建连接工厂对象</span></span><br><span class="line">    ConnectionFactory connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(<span class="string">"tcp://localhost:61616"</span>);</span><br><span class="line">    <span class="comment">//从工厂中获取一个连接对象</span></span><br><span class="line">    Connection connection = connectionFactory.createConnection();</span><br><span class="line">    <span class="comment">//连接MQ服务</span></span><br><span class="line">    connection.start();</span><br><span class="line">    <span class="comment">//获得session对象</span></span><br><span class="line">    Session session = connection.createSession(<span class="keyword">false</span>,Session.CLIENT_ACKNOWLEDGE);</span><br><span class="line">    <span class="comment">//创建目的地</span></span><br><span class="line">    Destination destination = session.createQueue(<span class="string">"dest"</span>);</span><br><span class="line">    <span class="comment">//创建消费者对象</span></span><br><span class="line">    MessageConsumer consumer = session.createConsumer(destination);</span><br><span class="line">    <span class="comment">//注册监听器,注册成功后，队列中的消息变化会主动触发监听器代码</span></span><br><span class="line">    consumer.setMessageListener(<span class="keyword">new</span> MessageListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//acknowledge()方法确认，代表consumer已接收到消息，之后mq删除对应的消息</span></span><br><span class="line">                message.acknowledge();</span><br><span class="line">                TextMessage textMessage = (TextMessage)message;</span><br><span class="line">                System.out.println(<span class="string">"读取的消息："</span> + textMessage);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//阻塞当前代码，保证listener代码未结束，如果代码结束，监听器自动关闭</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Publish-Subscribe-Pub-Sub-发布订阅模式"><a href="#Publish-Subscribe-Pub-Sub-发布订阅模式" class="headerlink" title="Publish/Subscribe(Pub/Sub)发布订阅模式"></a>Publish/Subscribe(Pub/Sub)发布订阅模式</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><ul>
<li>Pub/Sub模式基于Topic实现的消息处理方式</li>
<li>Pub/Sub模式包含3个角色：主题(Topic),发布者(Publisher),订阅者(Subscriber)</li>
<li>多个发布者将消息发送到Topic，系统将这些消息传递给多个订阅者</li>
</ul>
<p>==如果希望发送的消息可以被多个消费者处理的话，那么可以采用Pub/Sub模型==</p>
<h3 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h3><ul>
<li>每个消息可以有多个消费者</li>
<li>发布者和订阅者之间有时间上的依赖性，针对某个主题(Topic)的订阅者，它必须创建一个订阅后才能消费发布者的消息</li>
<li>当生产者发布消息，不管有没有消费者，都不会保存消息</li>
<li>为了消费消息，订阅者必须保持运行状态</li>
<li>为了缓和这样严格的时间相关性，JMS运行订阅者创建一个可持久化的订阅，这样即使订阅者没有被激活(运行)，它也能接收到发布者的消息</li>
</ul>
<h3 id="Topic消息失败重发"><a href="#Topic消息失败重发" class="headerlink" title="Topic消息失败重发"></a>Topic消息失败重发</h3><h5 id="demo-1"><a href="#demo-1" class="headerlink" title="demo"></a>demo</h5><ul>
<li>消息消费端在创建session对象时需指定应答模式为客户端手动应答</li>
<li>当消费者获取到消息并成功处理后需要调用 ==message.acknowledge()== 方法进行应答，通知Broker消费成功</li>
<li>如果处理过程出现异常，需调用 ==session.recover()== 通知Broker重发消息，重发有次数限制</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActiveMQTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">//消息的发送方-------生产者</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">        <span class="comment">/**创建连接工厂对象</span></span><br><span class="line"><span class="comment">         * 创建工厂构造方法有3个参数，分别为用户名，密码，连接地址</span></span><br><span class="line"><span class="comment">         * 无参构造：有默认的连接地址，本地连接</span></span><br><span class="line"><span class="comment">         * 一个参数(连接地址)的构造：无验证模式的，没有用户认证</span></span><br><span class="line"><span class="comment">         * 三个参数的构造：有认证+指定地址，默认端口61616，可以在conf/activemq.xml文件中查看</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        ConnectionFactory connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(<span class="string">"tcp://localhost:61616"</span>);</span><br><span class="line">        <span class="comment">//从工厂中获取一个连接对象</span></span><br><span class="line">        Connection connection = connectionFactory.createConnection();</span><br><span class="line">        <span class="comment">/**建议启动连接，生产者不是必须启动连接，但消费者必须启动连接</span></span><br><span class="line"><span class="comment">         * 生产者在发送消息的时候，会检查是否启动了连接，如果未启动，会自动启动</span></span><br><span class="line"><span class="comment">         * 如果有特殊的配置，建议配置完毕后再启动连接</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        connection.start();</span><br><span class="line">        <span class="comment">//获得session对象</span></span><br><span class="line">        Session session = connection.createSession(<span class="keyword">false</span>,Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">        <span class="comment">//通过session对象创建topic</span></span><br><span class="line">        Topic topic = session.createTopic(<span class="string">"testTopic"</span>);</span><br><span class="line">        <span class="comment">//通过session对象创建消息的发送者</span></span><br><span class="line">        MessageProducer messageProducer = session.createProducer(topic);</span><br><span class="line">        <span class="comment">//通过sesion对象创建消息对象</span></span><br><span class="line">        TextMessage textMessage = session.createTextMessage(<span class="string">"测试的文本消息"</span>);</span><br><span class="line">        <span class="comment">//通过发送者发送消息</span></span><br><span class="line">        messageProducer.send(textMessage);</span><br><span class="line">        <span class="comment">//关闭资源</span></span><br><span class="line">        messageProducer.close();</span><br><span class="line">        session.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//消息的接收方-----消费者</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> <span class="keyword">throws</span> JMSException </span>&#123;</span><br><span class="line">        <span class="comment">//创建连接工厂对象</span></span><br><span class="line">        ConnectionFactory connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(<span class="string">"tcp://localhost:61616"</span>);</span><br><span class="line">        <span class="comment">//从工厂中获取一个连接对象</span></span><br><span class="line">        Connection connection = connectionFactory.createConnection();</span><br><span class="line">        <span class="comment">//连接MQ服务</span></span><br><span class="line">        connection.start();</span><br><span class="line">        <span class="comment">//获得session对象</span></span><br><span class="line">        <span class="keyword">final</span> Session session = connection.createSession(<span class="keyword">false</span>,Session.CLIENT_ACKNOWLEDGE);</span><br><span class="line">        <span class="comment">//通过session对象创建topic</span></span><br><span class="line">        Topic topic = session.createTopic(<span class="string">"testTopic"</span>);</span><br><span class="line">        <span class="comment">//通过session对象创建消息的接收者</span></span><br><span class="line">        MessageConsumer messageConsumer = session.createConsumer(topic);</span><br><span class="line">        <span class="comment">//指定消息的监听器</span></span><br><span class="line">        messageConsumer.setMessageListener(<span class="keyword">new</span> MessageListener() &#123;</span><br><span class="line">            <span class="comment">//当监听的topic中存在消息，这个方法自动执行</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">                TextMessage textMessage = (TextMessage) message;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(textMessage.getText().equals(<span class="string">"ping"</span>))&#123;</span><br><span class="line">                        System.out.println(<span class="string">"消费者接收到的消息："</span> + textMessage.getText());</span><br><span class="line">                        <span class="comment">//客户端手动应答</span></span><br><span class="line">                        message.acknowledge();</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="comment">//模拟消息处理失败</span></span><br><span class="line">                        System.out.println(<span class="string">"消息处理失败"</span>);</span><br><span class="line">                        <span class="comment">//通知mq进行消息重发</span></span><br><span class="line">                        session.recover();</span><br><span class="line">                        <span class="keyword">int</span> i = <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="P2P和SUB对比"><a href="#P2P和SUB对比" class="headerlink" title="P2P和SUB对比"></a>P2P和SUB对比</h2><table>
<thead>
<tr>
<th></th>
<th>Topic</th>
<th>Queue</th>
</tr>
</thead>
<tbody><tr>
<td>有无状态</td>
<td>topic数据默认不落地，是无状态的,消息发送后mq中不存储</td>
<td>Queue数据默认会在mq服务器上以文件形式保存，比如ActiveMQ一般保存在$AMQ_HOME/data/kahadb下，也可以配置成DB存储</td>
</tr>
<tr>
<td>完整性保障</td>
<td>不保证发布者发布的每条数据，订阅者都能收到</td>
<td>Queue保证每条数据都能被接收到，前提是消息未超时</td>
</tr>
<tr>
<td>消息是否会丢失</td>
<td>发布者发布消息到某个topic时，只有正在监听该topic地址的订阅者能接收到消息，若没有订阅者在监听，该topic就丢失了</td>
<td>发送者发送消息到目标Queue，接收者可以异步接收这个Queue上的消息，Queue上的消息如果暂时没有接收者接收，也不会丢失，前提是消息未超时</td>
</tr>
<tr>
<td>消息发布接收策略</td>
<td>一对多的消息发布接收策略，监听同一个topic地址的多个订阅者都能收到发布者发送的消息，订阅者接收完通知mq服务器</td>
<td>一对一的消息发布接收策略，一个发送者发送的消息，只能有一个接收者接收，通知mq服务器已接受，mq服务器对queue中的消息采取删除或其他操作</td>
</tr>
</tbody></table>
<h1 id="ActiveMQ安全认证"><a href="#ActiveMQ安全认证" class="headerlink" title="ActiveMQ安全认证"></a>ActiveMQ安全认证</h1><p>即用户名密码登录规则，如果需要使用安全认证</p>
<ol>
<li>必须在activemq核心配置文件(conf/activemq.xml)中开启安全配置,在broker标签下添加如下内容：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  use JAAS to authenticate using the login.config file on the classpath to configure JAAS --&gt;</span></span><br><span class="line">　　　　　　　<span class="comment">&lt;!--  添加jaas认证插件activemq在login.config里面定义,详细见login.config--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">jaasAuthenticationPlugin</span> <span class="attr">configuration</span>=<span class="string">"activemq"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  lets configure a destination based authorization mechanism --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">authorizationPlugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">authorizationMap</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">authorizationEntries</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">authorizationEntry</span> <span class="attr">topic</span>=<span class="string">"&gt;"</span> <span class="attr">read</span>=<span class="string">"admins"</span> <span class="attr">write</span>=<span class="string">"admins"</span> <span class="attr">admin</span>=<span class="string">"admins"</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">authorizationEntry</span> <span class="attr">queue</span>=<span class="string">"&gt;"</span> <span class="attr">read</span>=<span class="string">"admins"</span> <span class="attr">write</span>=<span class="string">"admins"</span> <span class="attr">admin</span>=<span class="string">"admins"</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--authorizationEntry topic="FirstTopic" read="smeall,smeadmin" write="smeadmin" admin="smeall,smeadmin" /--&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">authorizationEntry</span> <span class="attr">topic</span>=<span class="string">"ActiveMQ.Advisory.&gt;"</span> <span class="attr">read</span>=<span class="string">"admins"</span> <span class="attr">write</span>=<span class="string">"admins"</span> <span class="attr">admin</span>=<span class="string">"admins"</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">authorizationEntry</span> <span class="attr">queue</span>=<span class="string">"ActiveMQ.Advisory.&gt;"</span> <span class="attr">read</span>=<span class="string">"admins"</span> <span class="attr">write</span>=<span class="string">"admins"</span> <span class="attr">admin</span>=<span class="string">"admins"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">authorizationEntries</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">authorizationMap</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">authorizationPlugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>开启认证后，认证使用的用户信息由其他配置文件提供conf/login.config<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">activemq &#123;</span><br><span class="line">    org.apache.activemq.jaas.PropertiesLoginModule required</span><br><span class="line">        org.apache.activemq.jaas.properties.user="users.properties"</span><br><span class="line">        org.apache.activemq.jaas.properties.group="groups.properties";</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
conf/users.properties中”用户名=密码”<br>conf/groups.properties中”用户组名=用户名，用户名”</li>
</ol>
<h1 id="ActiveMQ持久化"><a href="#ActiveMQ持久化" class="headerlink" title="ActiveMQ持久化"></a>ActiveMQ持久化</h1><ul>
<li>ActiveMQ中持久化是指对消息数据的持久化</li>
<li>在ActiveMQ中，默认的消息保存在内存中</li>
<li>当内存容量不足的时候，或ActiveMQ正常关闭的时候，会将内存中未处理的消息持久化到磁盘中，具体的持久化策略由配置文件中具体配置决定</li>
<li>默认存储策略是kahadb</li>
<li>如果使用jdbc作为持久化策略，则会将所有的需要持久化的消息保存到数据库中</li>
<li>所有持久化配置都在conf/activemq.xml中，配置信息在broker标签中定义</li>
</ul>
<h2 id="kahadb方式-默认"><a href="#kahadb方式-默认" class="headerlink" title="kahadb方式(默认)"></a>kahadb方式(默认)</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">persistenceAdapter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">kahaDB</span> <span class="attr">directory</span>=<span class="string">"$&#123;activemq.data&#125;/kahadb"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">persistenceAdapter</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><ul>
<li>kahadb是一个文件型数据库，使用内存+文件保证数据持久化</li>
<li>kahadb可以限制每个数据文件的大小，不代表总计数据容量</li>
</ul>
<h3 id="特点-2"><a href="#特点-2" class="headerlink" title="特点"></a>特点</h3><ul>
<li>日志形式存储消息</li>
<li>消息索引以B-Tree结构存储，可以快速更新</li>
<li>完全支持JMS事务</li>
<li>支持多种恢复机制</li>
</ul>
<h2 id="JDBC持久化方式"><a href="#JDBC持久化方式" class="headerlink" title="JDBC持久化方式"></a>JDBC持久化方式</h2><h3 id="前期工作"><a href="#前期工作" class="headerlink" title="前期工作"></a>前期工作</h3><ul>
<li>ActiveMQ将数据持久化到数据库中，不指定具体数据库，这里以mysql为例</li>
<li>其中jdbcPersistenceAdapter标签中的createTableOnStartup属性默认为true，表示每次启动时都去创建数据表，一般是第一次启动时设置为true，之后改为false</li>
<li>将mysql的数据库驱动jar包复制到activeMQ的lib目录下</li>
<li>创建相应的数据库(demo数据库名为activemq)，之后启动activemq会在对应的数据库创建3张表</li>
</ul>
<hr>
<p>activemq_msgs表存储消息，Queue和Topic都存储在这个表中<br>字段 | 描述<br>—|—<br>ID | 自增主键<br>container | 消息的destination<br>msgid_prod | 消息发送者客户端的主键<br>msg_seq | 发送消息的顺序，msgid_prop+msg_seq可以组成JMS的MessageID<br>expiration | 消息的过期时间，存储的是从1970-01-01到现在的毫秒数<br>msg | 消息本体的java序列化对象的二进制数据<br>priority | 优先级，从0-9，数值越大优先级越高</p>
<hr>
<p>activemq_acks表存储订阅关系，如果是持久化Topic，订阅者和服务器的订阅关系保存在这<br>字段 | 描述<br>—|—<br>container | 消息的destination<br>sub_dest | 如果是使用static集群，这个字段会有集群其他系统的信息<br>client_id | 每个订阅者都必须有一个唯一的客户端id<br>sub_name | 订阅者名称<br>selector | 选择器，可以选择只消费满足条件的消息，条件可以用自定义属性实现，可支持多属性AND和OR操作<br>last_acked_id | 记录消费过的消息的ID</p>
<hr>
<p>activemq_lock表在集群环境中才有用，只有一个Broker可以获得消息，称为Master Broker，其他的只能作为备份等待Master Broker不可用，才可能成为下一个Master Broker，这个表用来记录哪个Broker是当前的Master Broker</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"mysql-ds"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="attr">destory-method</span>=<span class="string">"close"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">""</span><span class="attr">jdbc:mysql:</span>//<span class="attr">localhost:3306</span>/<span class="attr">activemq</span>?<span class="attr">relaxAutoCommit</span>=<span class="string">true/</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"poolPreparedStatements"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">broker</span> <span class="attr">xmlns</span>=<span class="string">"http://activemq.apache.org/schema/core"</span> <span class="attr">brokerName</span>=<span class="string">"localhost"</span> <span class="attr">dataDirectory</span>=<span class="string">"$&#123;activemq.data&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">persistenceAdapter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcPersistenceAdapter</span> <span class="attr">dataDirectory</span>=<span class="string">"$&#123;activemq.base&#125;/data"</span> <span class="attr">dataSource</span>=<span class="string">"#mysql-ds"</span> <span class="attr">createTableOnStartup</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">persistenceAdapter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">broker</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="demo-2"><a href="#demo-2" class="headerlink" title="demo"></a>demo</h3><ol>
<li>消息发送方发送时send()方法改变<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建连接工厂对象</span></span><br><span class="line">ConnectionFactory connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(<span class="string">"tcp://localhost:61616"</span>);</span><br><span class="line"><span class="comment">//从工厂中获取一个连接对象</span></span><br><span class="line">Connection connection = connectionFactory.createConnection();</span><br><span class="line"><span class="comment">//连接MQ服务</span></span><br><span class="line">connection.start();</span><br><span class="line"><span class="comment">//获得session对象</span></span><br><span class="line">Session session = connection.createSession(<span class="keyword">false</span>,Session.AUTO_ACKNOWLEDGE);</span><br><span class="line"><span class="comment">//通过session对象创建topic</span></span><br><span class="line">Topic topic = session.createTopic(<span class="string">"testTopic"</span>);</span><br><span class="line"><span class="comment">//通过session对象创建消息的发送者</span></span><br><span class="line">MessageProducer messageProducer = session.createProducer(topic);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*message：发送的消息</span></span><br><span class="line"><span class="comment">*deliveryMode：取值为DeliveryMode.PERSISTENT 表示持久化</span></span><br><span class="line"><span class="comment">*priority：优先级</span></span><br><span class="line"><span class="comment">*timeToLive：超时时间，单位ms</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">messageProducer.send(message,deliveryMode,priority,timeToLive)</span><br></pre></td></tr></table></figure></li>
<li>消息接收方设置clientID以及创建消息接收者方法改变<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建连接工厂对象</span></span><br><span class="line">ConnectionFactory connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(<span class="string">"tcp://localhost:61616"</span>);</span><br><span class="line"><span class="comment">//从工厂中获取一个连接对象</span></span><br><span class="line">Connection connection = connectionFactory.createConnection();</span><br><span class="line"><span class="comment">//连接MQ服务</span></span><br><span class="line">connection.start();</span><br><span class="line">connection.setClientID(<span class="string">"client-1"</span>);</span><br><span class="line"><span class="comment">//获得session对象</span></span><br><span class="line">Session session = connection.createSession(<span class="keyword">false</span>,Session.CLIENT_ACKNOWLEDGE);</span><br><span class="line"><span class="comment">//通过session对象创建topic</span></span><br><span class="line">Topic topic = session.createTopic(<span class="string">"testTopic"</span>);</span><br><span class="line"><span class="comment">//通过session对象创建消息接收者</span></span><br><span class="line">TopicSubscriber consumer = session.createDurableSubscriber(topic,<span class="string">"client1-sub"</span>);</span><br></pre></td></tr></table></figure></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/10/CSS/css3(%E8%BF%87%E6%B8%A1%EF%BC%8C%E5%8F%98%E5%BD%A2)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="llz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="llz's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/10/CSS/css3(%E8%BF%87%E6%B8%A1%EF%BC%8C%E5%8F%98%E5%BD%A2)/" itemprop="url">css3(过渡，变形)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-10T10:23:48+08:00">
                2018-12-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSS/" itemprop="url" rel="index">
                    <span itemprop="name">CSS</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSS/CSS3/" itemprop="url" rel="index">
                    <span itemprop="name">CSS3</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="过渡"><a href="#过渡" class="headerlink" title="过渡"></a>过渡</h1><ul>
<li>过渡结束时可以监听<code>transitionend</code>事件,在webkit下是<code>webkitTransitionEnd</code>事件</li>
<li>每一个拥有过渡的属性在完成过渡时都会触发一次<code>transitionend</code>事件</li>
<li>在transition完成前设置<code>display:none</code>，过渡事件就不会被触发</li>
<li>在元素首次渲染还未完成时不会触发过渡</li>
<li>在绝大部分变换样式切换中，如果变换函数位置，个数不相同也不会触发过渡</li>
</ul>
<h1 id="transform变形"><a href="#transform变形" class="headerlink" title="transform变形"></a>transform变形</h1><h2 id="前置属性"><a href="#前置属性" class="headerlink" title="前置属性"></a>前置属性</h2><h3 id="transform-origin指定变形中心点"><a href="#transform-origin指定变形中心点" class="headerlink" title="transform-origin指定变形中心点"></a>transform-origin指定变形中心点</h3><ul>
<li>指定变形的中心点，默认为元素正中心，正值表示正向位移，负值负向位移(X,Y,Z轴正向分别为向右，向下，靠近用户眼睛)</li>
<li>二维的x-offset/y-offset可以设px，%，关键字(top,center等)，- 三维z-offset只能为px</li>
<li>该属性对translate没有影响，translate始终相对于元素正中心位移</li>
</ul>
<h3 id="transform-style指定舞台为2D或3D"><a href="#transform-style指定舞台为2D或3D" class="headerlink" title="transform-style指定舞台为2D或3D"></a>transform-style指定舞台为2D或3D</h3><p>取值：</p>
<ul>
<li>flat(2D)</li>
<li>preserve-3d(3D)</li>
</ul>
<p>需在变形元素父级上（舞台上）设置该属性。若同时设置transform-style:preserve-3d和overflow:hidden(包括祖先元素)，3D效果将失效，当设置为preserve-3d时，当元素进入舞台背面后会消失</p>
<h3 id="perspective指定3D的视距"><a href="#perspective指定3D的视距" class="headerlink" title="perspective指定3D的视距"></a>perspective指定3D的视距</h3><p>即人眼距显示器的距离，只能设px，该属性设置在舞台元素上，不是进行3D变换的元素上</p>
<h3 id="perspective-origin设置视距的基点"><a href="#perspective-origin设置视距的基点" class="headerlink" title="perspective-origin设置视距的基点"></a>perspective-origin设置视距的基点</h3><p>即设置人眼的位置，默认在50%，50%，即中心处，需和perspective一起使用     </p>
<h3 id="backface-visibility设置是否看见3D舞台的背面"><a href="#backface-visibility设置是否看见3D舞台的背面" class="headerlink" title="backface-visibility设置是否看见3D舞台的背面"></a>backface-visibility设置是否看见3D舞台的背面</h3><p>默认值visible可见，可设hidden隐藏</p>
<h2 id="2D变形transform"><a href="#2D变形transform" class="headerlink" title="2D变形transform"></a>2D变形transform</h2><p>只对块级元素有效</p>
<h3 id="旋转rotate"><a href="#旋转rotate" class="headerlink" title="旋转rotate"></a>旋转rotate</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">transform</span><span class="selector-pseudo">:rotate()</span></span><br></pre></td></tr></table></figure>

<p>只能设单值，正数表示顺时针旋转(注：2D层面无rotateX()和rotateY())</p>
<h3 id="平移translate"><a href="#平移translate" class="headerlink" title="平移translate()"></a>平移translate()</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">transform</span><span class="selector-pseudo">:translate()</span></span><br></pre></td></tr></table></figure>
<p>可设单值或双值，设单值表示只x轴位移，y轴不变,有translateX()，translateY()</p>
<h3 id="倾斜skew"><a href="#倾斜skew" class="headerlink" title="倾斜skew()"></a>倾斜skew()</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">transform</span><span class="selector-pseudo">:skew()</span></span><br></pre></td></tr></table></figure>
<p>可设单值或双值，设单值表示只x轴倾斜，y轴不变，有skewX()和skewY()</p>
<h3 id="缩放scale"><a href="#缩放scale" class="headerlink" title="缩放scale()"></a>缩放scale()</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">transform</span><span class="selector-pseudo">:scale()</span></span><br></pre></td></tr></table></figure>
<ul>
<li>可设单值或双值，设单值表示x，y轴等值缩放。可设负数，负数会先将元素反转再缩放</li>
<li>只想x轴缩放scaleX(.5)  &lt;=====&gt;    scale(.5,1)    </li>
<li>只想y轴缩放scaleY(.5)  &lt;=====&gt;    scale(1,.5) </li>
</ul>
<h2 id="3D变形transform"><a href="#3D变形transform" class="headerlink" title="3D变形transform"></a>3D变形transform</h2><h3 id="位移translate3d-x-y-z"><a href="#位移translate3d-x-y-z" class="headerlink" title="位移translate3d(x,y,z)"></a>位移translate3d(x,y,z)</h3><p>其中z只能为px，z越大离眼睛越近，但大于perspective视距时元素会消失，有translateX(),translateY(),translateZ()</p>
<h3 id="缩放scale3d-x-y-z"><a href="#缩放scale3d-x-y-z" class="headerlink" title="缩放scale3d(x,y,z)"></a>缩放scale3d(x,y,z)</h3><p>还可单独设置z轴缩放scaleZ(),只在组合变换时有用，单独scaleZ()没有效果</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">transform:scaleZ(2) translateZ(100px)   //向前平移200px</span><br><span class="line">transform:translateZ(100px) scaleZ(2)   //向前平移100px</span><br></pre></td></tr></table></figure>


<h3 id="旋转rotate3d-x-y-z-a"><a href="#旋转rotate3d-x-y-z-a" class="headerlink" title="旋转rotate3d(x,y,z,a)"></a>旋转rotate3d(x,y,z,a)</h3><p>a表示旋转角度，可单独设置某个轴，rotateX(),rotateY(),rotateZ()，其中x，y，z为1时，表示按该轴旋转，为0时表示不按该轴旋转</p>
<h1 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h1><ul>
<li><p>动画内属性</p>
<ul>
<li>animation-name：设置对象所应用的动画名称</li>
<li>animation-duration：设置对象动画的持续时间</li>
<li>animation-timing-function：设置对象动画的过渡类型</li>
</ul>
</li>
<li><p>动画外属性</p>
<ul>
<li>animation-delay：设置对象动画延迟的时间</li>
</ul>
</li>
<li><p>animation-iteration-count：设置对象动画的循环次数，只作用于动画内属性，循环的是关键帧</p>
</li>
<li><p>animation-direction：设置对象动画的运动方向，反转的是关键帧和animation-timing-function</p>
</li>
<li><p>animation-fill-mode：设置对象动画时间之外的状态,即from之前和to之后的状态，取值如下：</p>
<ul>
<li>none</li>
<li>backwards：from前的状态和from一致</li>
<li>forwards：to之后的状态和to一致</li>
<li>both：包含backwards和forwards</li>
</ul>
</li>
<li><p>animation-play-state：控制动画运动或暂停</p>
</li>
</ul>
<h2 id="关键帧定义"><a href="#关键帧定义" class="headerlink" title="关键帧定义"></a>关键帧定义</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">keyframes</span> 动画名称&#123;</span><br><span class="line">    动画持续时间百分比&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    动画持续时间百分比&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>动画持续时间百分比使用from表示0%，to表示100%</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/03/Linux%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/Linux02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="llz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="llz's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/03/Linux%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/Linux02/" itemprop="url">Linux学习记录02</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-03T14:17:28+08:00">
                2018-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="组管理和权限管理"><a href="#组管理和权限管理" class="headerlink" title="组管理和权限管理"></a>组管理和权限管理</h1><h2 id="用户和组"><a href="#用户和组" class="headerlink" title="用户和组"></a>用户和组</h2><h3 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h3><ul>
<li>==<code>useradd [选项]  用户名</code>==：添加用户，创建用户成功后会自动创建和用户同名的家目录（不指定用户组的情况下）</li>
<li>==<code>useradd -g 用户组 用户名</code>==：添加用户同时指定该用户所在的用户组</li>
<li>==<code>useradd -d 指定目录 用户名</code>==：添加用户并指定家目录</li>
<li>==<code>passwd 用户名</code>==：给用户指定密码</li>
<li>==<code>userdel 用户名</code>==：删除用户保留家目录</li>
<li>==<code>userdel -r 用户名</code>==：删除用户和家目录</li>
<li>==<code>id 用户名</code>==：查看用户信息</li>
<li>==<code>su - 用户名</code>==：切换用户</li>
<li>==<code>exit</code>==：退出当前用户，返回上一个用户</li>
<li>==<code>whoami</code>==：查看当前是哪个用户</li>
</ul>
<h3 id="用户组"><a href="#用户组" class="headerlink" title="用户组"></a>用户组</h3><p>类似角色，系统可以对有共性的多个用户进行统一管理</p>
<ul>
<li>==<code>groupadd 组名</code>==：添加一个用户组</li>
<li>==<code>groupdel 组名</code>==：删除组</li>
<li>==<code>usermod -g 用户组 用户名</code>==：修改用户组</li>
<li>==<code>usermod -d 目录名 用户名</code>==：修改用户登录的初始目录</li>
</ul>
<h3 id="用户和组相关文件"><a href="#用户和组相关文件" class="headerlink" title="用户和组相关文件"></a>用户和组相关文件</h3><ul>
<li>用户配置文件(用户信息)，==<code>/etc/passwd</code>==，其中每行含义：==<code>用户名：口令：用户标识号：组标识号：注释性描述：家目录：登录shell</code>==</li>
<li>组配置文件(组信息)，==<code>/etc/group</code>==，其中每行含义：==<code>组名：口令：组标识号：组内用户列表</code>==</li>
<li>口令配置文件(密码和登录信息，加密)，==<code>/etc/shadow</code>==，其中每行含义：==<code>登录名：加密口令：最后一次修改时间：最小时间间隔：最大时间间隔：警告时间：不活动时间：失效时间：标志</code>==</li>
</ul>
<h3 id="查看文件所有者"><a href="#查看文件所有者" class="headerlink" title="查看文件所有者"></a>查看文件所有者</h3><p>==<code>ls -ahl</code>==：其中a表示全部，h表示以人易理解的格式列出文件大小，l表示除了文件名之外，还将文件的权限、所有者、文件大小等信息详细列出来</p>
<h3 id="修改文件所有者和所在组"><a href="#修改文件所有者和所在组" class="headerlink" title="修改文件所有者和所在组"></a>修改文件所有者和所在组</h3><ul>
<li>==<code>chown [选项] 用户名 文件名</code>==：修改文件所有者</li>
<li>==<code>chgrp [选项] 组名 文件名</code>==：修改文件所在组</li>
<li>==<code>chown [选项] 用户名:组名 文件名</code>==：同时改变文件所有者和所在组</li>
</ul>
<p>其中选项 ==-R== 如果是目录，则使其下所有子文件或目录递归生效</p>
<h2 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h2><p>==<code>ls -l</code>== 中显示的内容如下：  </p>
<blockquote>
<p>-rwxrw-r– 1 root root 1213 Feb 2 09:39 abc</p>
</blockquote>
<ul>
<li>第0位：确定文件类型，-表示普通文件，d表示目录，l表示软链接，c表示字符设备(如键盘，鼠标)，b表示块文件(如硬盘)</li>
<li>1-3位：表示文件所有者的权限，r表示读，w表示写，x(execute)表示可执行</li>
<li>4-6位：表示文件所在组的权限</li>
<li>7-9位：表示文件其他组的用户的权限</li>
<li>权限后的1如果是文件，表示硬链接的数，如果是目录则表示该目录的子目录个数</li>
<li>第一个root表示文件的所有者</li>
<li>第二个root表示文件所在组</li>
<li>1213表示文件大小，单位字节，如果是目录，则大小显示为4096</li>
</ul>
<h3 id="rwx权限详解"><a href="#rwx权限详解" class="headerlink" title="rwx权限详解"></a>rwx权限详解</h3><h4 id="rwx作用于文件"><a href="#rwx作用于文件" class="headerlink" title="rwx作用于文件"></a>rwx作用于文件</h4><ul>
<li>==r== ：可读(read)</li>
<li>==w== ：可写(write)，可以修改，但是不代表可以删除该文件，删除一个文件的前提条件是对该文件所在的目录有写权限，才能删除该文件.</li>
<li>==x== ：可执行(execute):可以被执行</li>
</ul>
<h4 id="rwx作用于目录"><a href="#rwx作用于目录" class="headerlink" title="rwx作用于目录"></a>rwx作用于目录</h4><ul>
<li>==r== ：可读(read)，可以读取， ls查看目录内容</li>
<li>==w== ：可写(write)，可以修改，目录内创建+删除+重命名目录</li>
<li>==x== ：可执行(execute)，可以进入该目录</li>
</ul>
<h3 id="修改权限"><a href="#修改权限" class="headerlink" title="修改权限"></a>修改权限</h3><p>==chmod==指令用于修改文件或目录权限</p>
<h4 id="方一：-，-，-变更权限"><a href="#方一：-，-，-变更权限" class="headerlink" title="方一：+，-，=变更权限"></a>方一：+，-，=变更权限</h4><blockquote>
<p>u：所有者<br>g：所在组<br>o：其他人<br>a：所有人(u,g,o总和)</p>
</blockquote>
<ul>
<li>==<code>chmod u=rwx,g=rx,o=x 文件目录名</code>==：给该文件或目录所有者赋权限rwx，所在组赋权限rx，其他人赋权限x</li>
<li>==<code>chmod o+w 文件目录名</code>==：给该文件或目录其他人添加权限w</li>
<li>==<code>chmod a-x 文件目录名</code>==：给该文件或目录所有人去掉权限x</li>
</ul>
<h4 id="方二：通过数字变更权限"><a href="#方二：通过数字变更权限" class="headerlink" title="方二：通过数字变更权限"></a>方二：通过数字变更权限</h4><blockquote>
<p>r = 4<br>w = 2<br>x = 1<br>rwx = 4 + 2 + 1 = 7  </p>
</blockquote>
<p>==<code>chmod 751 文件目录名</code>== 等价于 ==<code>chmod u=rwx,g=rx,o=x 文件目录名</code>==</p>
<h1 id="crond任务调度"><a href="#crond任务调度" class="headerlink" title="crond任务调度"></a>crond任务调度</h1><h2 id="任务调度"><a href="#任务调度" class="headerlink" title="任务调度"></a>任务调度</h2><p>系统在某个时间执行的特定的命令或程序  </p>
<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><ol>
<li>系统工作：有些重要的工作必须周而复始地执行。如病毒扫描等  </li>
<li>个别用户工作：个别用户可能希望执行某些程序，比如对mysql数据库的备份</li>
</ol>
<blockquote>
<p>crontab [选项]</p>
</blockquote>
<p>常用选项：</p>
<ul>
<li>==-e==：编辑crontab定时任务</li>
<li>==-l==：查询crontab任务</li>
<li>==-r==：删除当前用户所有的crontab任务</li>
</ul>
<p><img src="https://note.youdao.com/yws/api/personal/file/088880AB4D0D40518C76431EB894E6A5?method=download&shareKey=77b591189f3d496de95289d4ce682a7a" alt=""></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/057FE3D11C93408C901D2EF977493BDE?method=download&shareKey=8a6bd02ce8d3544e9a76bdfc494ab324" alt=""></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/AA31E33F23514DBB96DF2CBC7EF4F77A?method=download&shareKey=05ce7a11edb74614eeec2b1e6cd6a191" alt=""></p>
<h2 id="重启任务调度"><a href="#重启任务调度" class="headerlink" title="重启任务调度"></a>重启任务调度</h2><p>==service crond restart==</p>
<h1 id="磁盘分区和挂载"><a href="#磁盘分区和挂载" class="headerlink" title="磁盘分区和挂载"></a>磁盘分区和挂载</h1><h2 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h2><ul>
<li>mbr分区<ol>
<li>最多支持四个主分区</li>
<li>系统只能安装在主分区</li>
<li>扩展分区要占一个主分区</li>
<li>MBR最大只支持2TB，但拥有最好的兼容性</li>
</ol>
</li>
<li>gpt分区<ol>
<li>支持无限多个主分区（但操作系统可能限制，比如 windows下最多128个分区）</li>
<li>最大支持18EB的大容量（1EB=1024 PB， 1PB=1024 TB ）</li>
<li>windows7 64位以后支持gpt</li>
</ol>
</li>
</ul>
<h2 id="硬盘说明"><a href="#硬盘说明" class="headerlink" title="硬盘说明"></a>硬盘说明</h2><ul>
<li>linux硬盘分为IDE硬盘和SCSI硬盘</li>
<li>IDE硬盘的驱动器标识符为 ==hdx~==<ul>
<li>==hd==:分区所在设备类型，hd表示IDE硬盘</li>
<li>==x==：盘号，a为第一个硬盘，b为第二个，以此类推</li>
<li>==~==：分区，前4个分区用1-4表示，为主分区或扩展分区，5及以后为逻辑分区</li>
</ul>
</li>
<li>SCSI硬盘标识为 ==sdx~==</li>
</ul>
<h3 id="查看当前系统分区情况"><a href="#查看当前系统分区情况" class="headerlink" title="查看当前系统分区情况"></a>查看当前系统分区情况</h3><blockquote>
<p>lsblk -f</p>
</blockquote>
<p><img src="https://note.youdao.com/yws/api/personal/file/A7D44786D0524495B91378341465CE0A?method=download&shareKey=5a6fd7cd6c3a56fb94f0f2039fa4c6d9" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/24/Linux%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/Linux01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="llz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="llz's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/24/Linux%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/Linux01/" itemprop="url">Linux学习记录01</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-24T16:26:45+08:00">
                2018-08-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="虚拟机网络连接三种方式"><a href="#虚拟机网络连接三种方式" class="headerlink" title="虚拟机网络连接三种方式"></a>虚拟机网络连接三种方式</h1><ul>
<li>桥连接</li>
<li>NAT</li>
<li>主机模式</li>
</ul>
<p><img src="https://note.youdao.com/yws/api/personal/file/E0AB5B2165C245D68AA8349D5DECC7F0?method=download&shareKey=fc3e8821a960abb4213ee0692c3f213d" alt="虚拟机网络连接三种方式"></p>
<h1 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h1><h2 id="安装vmtools"><a href="#安装vmtools" class="headerlink" title="安装vmtools"></a>安装vmtools</h2><ul>
<li>可以直接粘贴命令在windows 和 centos系统之间</li>
<li>可以设置windows和centos的共享文件夹</li>
</ul>
<h2 id="设置共享文件夹"><a href="#设置共享文件夹" class="headerlink" title="设置共享文件夹"></a>设置共享文件夹</h2><p>菜单栏 -&gt; 虚拟机 -&gt; 设置 -&gt; 选项 -&gt; 共享文件夹<br>linux中共享文件夹在 ==<code>/mnt/hgfs/</code>== 下 </p>
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><ul>
<li>==bin==：存放指令</li>
<li>==home==：存放普通用户的主目录，在linux中每个用户都有一个自己的目录，一般该目录以用户账号命名</li>
<li>==root==：该目录为系统管理员的主目录</li>
<li>==etc==：所有的系统管理所需要的配置文件和子目录</li>
<li>==usr==：用户的很多应用程序和文件都放在这个目录下，类似windows下的program files目录</li>
<li>==boot==：存放启动linux的核心文件，包括一些连接文件和镜像文件</li>
<li>==media==：linux系统会自动识别一些设备，例如U盘、光驱等等，当识别后， linux<br>会把识别的设备挂载到这个目录下</li>
<li>==mnt==：系统提供该目录是为了让用户临时挂载别的文件系统的，我们可以将外部的存储挂<br>载在/mnt/上，然后进入该目录就可以查看里面的内容了</li>
<li>==dev==：类似于windows的设备管理器，把所有的硬件用文件的形式存储</li>
<li>==usr/local==：这是另一个给主机额外安装软件所安装的目录。一般是通过编译源码方式安装的程序</li>
<li>==opt==：这是给主机额外安装软件所摆放的目录。如安装ORACLE数据库就可放到该目录下。<br>默认为空</li>
<li>==var==：这个目录中存放着在不断扩充着的东西，习惯将经常被修改的目录放在这个目录下。<br>包括各种日志文件</li>
</ul>
<h2 id="远程连接linux服务器"><a href="#远程连接linux服务器" class="headerlink" title="远程连接linux服务器"></a>远程连接linux服务器</h2><p>需要linux开启sshd服务，监听22端口 </p>
<h2 id="vim的三种常见模式"><a href="#vim的三种常见模式" class="headerlink" title="vim的三种常见模式"></a>vim的三种常见模式</h2><h3 id="一般-正常模式"><a href="#一般-正常模式" class="headerlink" title="一般/正常模式"></a>一般/正常模式</h3><h3 id="编辑模式"><a href="#编辑模式" class="headerlink" title="编辑模式"></a>编辑模式</h3><h3 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h3><p><img src="https://note.youdao.com/yws/api/personal/file/369ECC2B3B31423FB0709672B42AD1E1?method=download&shareKey=509e9021fb1b61c31cf38f76003674cd" alt="模式间的转化"><br>其中</p>
<ul>
<li>==<code>:wq</code>== 表示保存并退出</li>
<li>==<code>:q</code>== 退出(一般未编辑文件时退出使用)</li>
<li>==<code>:q!</code>== 强制退出不保存</li>
</ul>
<h3 id="vim快捷键"><a href="#vim快捷键" class="headerlink" title="vim快捷键"></a>vim快捷键</h3><ul>
<li>==<code>yy</code>==：copy当前行，yy前加数字n，表示copy当前行下面的n行，4yy表示copy当前行下面的4行(包含当前行)  </li>
<li>==<code>p</code>==：粘贴</li>
<li>==<code>dd</code>==：删除，其他同yy，也可加数字</li>
<li>查找：在命令模式下输入 ==<code>/关键字</code>==，之后回车，查找下一个按 ==<code>n</code>==</li>
<li>==<code>:set nu</code>==：设置行号</li>
<li>==<code>:set nonu</code>==：取消行号</li>
<li>==<code>G</code>==：跳到最后一行</li>
<li>==<code>gg</code>==：跳到第一行</li>
<li>跳到指定的行：<ol>
<li>启用行号，==<code>:set nu</code>==</li>
<li>输入要跳至的行数</li>
<li>输入==<code>shift g</code>==</li>
</ol>
</li>
<li>==<code>u</code>==：撤销上一步操作</li>
</ul>
<h2 id="linux指令"><a href="#linux指令" class="headerlink" title="linux指令"></a>linux指令</h2><h3 id="开关机"><a href="#开关机" class="headerlink" title="开关机"></a>开关机</h3><ul>
<li>==<code>shutdown -h now</code>==：立刻关机</li>
<li>==<code>shutdown -h 1</code>==：1分钟后关机</li>
<li>==<code>shutdown -r now</code>==：立即重启</li>
<li>==<code>halt</code>==：效果等价于关机</li>
<li>==<code>reboot</code>==：重启系统</li>
<li>==<code>sync</code>==：把内存的数据同步到磁盘，不管重启还是关机，先运行sync命令，防止数据丢失</li>
<li>==<code>logout</code>==：注销用户</li>
</ul>
<h3 id="运行级别"><a href="#运行级别" class="headerlink" title="运行级别"></a>运行级别</h3><p>0：关机<br>1：单用户（找回丢失密码）<br>2：多用户无网络服务<br>3：多用户有网络服务<br>4：保留<br>5：图形界面<br>6：重启<br>系统的运行级别配置文件在 ==<code>/etc/inittab</code>== 下  </p>
<ul>
<li>==<code>init 级别</code>==：切换到指定运行级别</li>
</ul>
<h4 id="找回root密码"><a href="#找回root密码" class="headerlink" title="找回root密码"></a>找回root密码</h4><p>思路：进入单用户模式，然后修改root密码，因为进入单用户模式root不需要密码就可以进入<br>步骤：在系统启动时不停按 ==<code>enter</code>== 键，然后按 ==<code>e</code>==，之后选择第二项==kernel…==，再输入 ==<code>e</code>==,之后空格输入 ==<code>1</code>== 后 ==<code>enter</code>==，然后输入 ==<code>b</code>==</p>
<h3 id="帮助指令"><a href="#帮助指令" class="headerlink" title="帮助指令"></a>帮助指令</h3><ul>
<li>==<code>man 命令</code>==：查看某指令的用法</li>
<li>==<code>help 命令</code>==：查看指令帮助信息</li>
</ul>
<h3 id="文件目录类"><a href="#文件目录类" class="headerlink" title="文件目录类"></a>文件目录类</h3><h4 id="显示查看"><a href="#显示查看" class="headerlink" title="显示查看"></a>显示查看</h4><ul>
<li><p>==<code>pwd</code>==：显示当前工作目录的绝对路径</p>
</li>
<li><p>==<code>ls [选项] [目录或文件]</code>==：显示文件或目录，常用选项有：==<code>-a</code>== 显示所有文件和目录，包括隐藏的，==<code>-l</code>== 以列表形式显示</p>
</li>
<li><p>==<code>cat [选项] 要查看的文件</code>==：以只读方式查看文件内容，常用选项 ==<code>-n</code>== 显示行号，当文件较长时，使用 ==<code>cat -n 要查看的文件 | more</code>== 分页显示</p>
</li>
<li><p>==<code>more 要查看的文件</code>==：以全屏幕的方式按页显示文本文件的内容</p>
<ol>
<li>==<code>空格</code>==：向下翻页</li>
<li>==<code>enter</code>==：向下翻一行</li>
<li>==<code>q</code>==：立刻离开more，不再显示该文件内容</li>
<li>==<code>ctrl + F</code>==：向下滚动一屏</li>
<li>==<code>ctrl + B</code>==：返回上一屏</li>
<li>==<code>=</code>==：输出当前行的行号</li>
<li>==<code>:f</code>==：输出文件名和当前行的行号</li>
</ol>
</li>
</ul>
<ul>
<li><p>==<code>less 要查看的文件</code>==：分屏查看文件内容，比more更强大，支持各种显示终端。less指令在显示文件内容时，并不是一次将整个文件加载之后才显示，而是根据显示需要加载内容，==对于显示大型文件具有较高的效率==</p>
<ol>
<li>==<code>空格</code>==：向下翻页</li>
<li>==<code>[pagedown]</code>==：向下翻页</li>
<li>==<code>[pageup]</code>==：向上翻页</li>
<li>==<code>/字串</code>==：向下搜索字串，==<code>n</code>==：向下查找，==<code>N</code>==：向上查找</li>
<li>==<code>?字串</code>==：向上搜寻字串的功能；==<code>n</code>==：向上查找； ==<code>N</code>==：向下查找</li>
<li>==<code>q</code>==：离开less程序</li>
</ol>
</li>
<li><p>==<code>echo [选项] [输出内容]</code>==：输出内容到控制台</p>
</li>
<li><p>==<code>head 文件</code>==：查看文件头10行的内容(默认)</p>
</li>
<li><p>==<code>head -n 5 文件</code>==：查看文件头5行的内容</p>
</li>
<li><p>==<code>tail 文件</code>==：查看文件尾10行内容(默认)</p>
</li>
<li><p>==<code>tail -n 5 文件</code>==：查看文件尾5行的内容</p>
</li>
<li><p>==<code>tail -f 文件</code>==：==实时追踪该文档的所有更新==</p>
</li>
</ul>
<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><ul>
<li>==<code>rmdir [选项] 要删除的空目录</code>==：删除空目录，若目录下有内容无法删除</li>
<li>==<code>rm -rf 要删除的目录</code>==：删除非空目录</li>
<li>==<code>rm [选项] 要删除的文件或目录</code>==：删除文件或目录，常用选项 ==<code>-r</code>== 递归删除整个文件夹,==<code>-f</code>== 强制删除不提示</li>
</ul>
<h4 id="新建"><a href="#新建" class="headerlink" title="新建"></a>新建</h4><ul>
<li>==<code>mkdir [选项] 要创建的目录</code>==：创建目录，常用选项有 ==<code>-p</code>== 创建多级目录</li>
<li>==<code>touch 文件名称1 文件名称2 ...</code>==：创建空文件，可创建多个</li>
</ul>
<h4 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h4><ul>
<li>==<code>cp [选项] 源文件 目的文件</code>==：常用选项 ==<code>-r</code>== 递归复制整个文件夹，在cp指令前加上==<code>\</code>==表示强制覆盖，即目的文件夹中已有同名的文件夹直接覆盖</li>
</ul>
<h4 id="移动"><a href="#移动" class="headerlink" title="移动"></a>移动</h4><ul>
<li>==<code>mv</code>==：移动文件或重命名<ol>
<li>==<code>mv 原文件名 新文件名</code>==：重命名</li>
<li>==<code>mv 原位置 新位置</code>==：移动文件</li>
</ol>
</li>
</ul>
<h4 id="gt-和-gt-gt-指令"><a href="#gt-和-gt-gt-指令" class="headerlink" title="&gt;和&gt;&gt;指令"></a>&gt;和&gt;&gt;指令</h4><p>&gt;输出重定向(覆盖原内容)，&gt;&gt;追加</p>
<ol>
<li>==<code>ls -l &gt; 文件</code>==：将 ==<code>ls -l</code>== 显示的内容写入文件中(覆盖写)</li>
<li>==<code>ls -al &gt;&gt; 文件</code>==：将 ==<code>ls -al</code>== 显示的内容追加到文件末尾</li>
<li>==<code>cat 文件1 &gt; 文件2</code>==：文件1的内容覆盖到文件2</li>
<li>==<code>echo &quot;内容&quot; &gt;&gt; 文件</code>==：将内容追加到文件末尾</li>
</ol>
<h4 id="ln指令"><a href="#ln指令" class="headerlink" title="ln指令"></a>ln指令</h4><p>软链接(符号链接)，类似于windows里的快捷方式， 主要存放了链接其他文件的路径<br>==<code>ln -s [原文件或目录] [软链接名]</code>==：给原文件创建软链接</p>
<h4 id="history指令"><a href="#history指令" class="headerlink" title="history指令"></a>history指令</h4><ul>
<li>==<code>history</code>==：查看已经执行过的历史命令</li>
<li>==<code>history 5</code>==：查看已经执行过最近5条历史命令</li>
<li>==<code>!n</code>==：其中n为数字，表示执行历史记录中第n条指令</li>
</ul>
<h3 id="时间日期类"><a href="#时间日期类" class="headerlink" title="时间日期类"></a>时间日期类</h3><h4 id="显示"><a href="#显示" class="headerlink" title="显示"></a>显示</h4><ul>
<li>==<code>date</code>==：显示当前时间</li>
<li>==<code>date +%Y</code>==：显示当前年份</li>
<li>==<code>date +%m</code>==：显示当前月份</li>
<li>==<code>date +%d</code>==：显示当前是哪一天</li>
<li>==<code>date &quot;+%Y-%m-%d %H:%M:%S&quot;</code>==：显示年月日时分秒</li>
<li>==<code>cal</code>==：显示日历</li>
<li>==<code>cal 2018</code>==:显示2018年的所有日历</li>
</ul>
<h4 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h4><ul>
<li>==<code>date -s 字符串时间</code>==：设置日期</li>
</ul>
<h3 id="搜索查找类"><a href="#搜索查找类" class="headerlink" title="搜索查找类"></a>搜索查找类</h3><h4 id="find指令"><a href="#find指令" class="headerlink" title="find指令"></a>find指令</h4><p>从指定目录向下递归地遍历其各个子目录，将满足条件的文件或者目录显示在终端<br>==<code>find [搜索范围] [选项]</code>==<br>其中选项有:  </p>
<ul>
<li>==<code>-name 文件名</code>==： 按照指定的文件名查找模式查找文件</li>
<li>==<code>-user 用户名</code>==： 查找属于指定用户名所有文件</li>
<li>==<code>-size 文件大小</code>==： 按照指定的文件大小查找文件</li>
<li>==<code>-size +20M</code>==： 查找大于20M的文件</li>
<li>==<code>-size -20M</code>==： 查找小于20M的文件</li>
<li>==<code>-size 20M</code>==： 查找等于20M的文件</li>
</ul>
<h4 id="locate指令"><a href="#locate指令" class="headerlink" title="locate指令"></a>locate指令</h4><ul>
<li>快速定位文件路径  </li>
<li>locate指令利用事先建立的系统中所有文件名称及路径的locate数据库实现快速定位给定的文件</li>
<li>locate指令无需遍历整个文件系统，查询速度较快</li>
<li>为了保证查询结果的准确度，管理员必须定期更新locate时刻</li>
<li>由于locate指令基于数据库进行查询，所以第一次运行前，必须使用updatedb指令创建locate数据库<br>==<code>locate 搜索的文件</code>==</li>
</ul>
<h4 id="grep指令"><a href="#grep指令" class="headerlink" title="grep指令"></a>grep指令</h4><p>过滤查找，管道符，“|”，表示将前一个命令的处理结果输出传递给后面的命令处理<br>==<code>grep [选项] 查找内容 源文件</code>==<br>其中选项有：</p>
<ul>
<li>==<code>-n</code>==：显示匹配行及行号</li>
<li>==<code>-i</code>==：忽略字母大小写</li>
</ul>
<p>==<code>cat hello.txt | grep -in yes</code>==：查找hello.txt中的yes</p>
<h3 id="压缩和解压类"><a href="#压缩和解压类" class="headerlink" title="压缩和解压类"></a>压缩和解压类</h3><h4 id="gzip和gunzip指令"><a href="#gzip和gunzip指令" class="headerlink" title="gzip和gunzip指令"></a>gzip和gunzip指令</h4><ul>
<li>==<code>gzip 文件</code>==：压缩文件，只能压缩为*.gz文件，不保留源文件</li>
<li>==<code>gunzip 文件.gz</code>==：解压缩文件</li>
</ul>
<h4 id="zip和unzip指令"><a href="#zip和unzip指令" class="headerlink" title="zip和unzip指令"></a>zip和unzip指令</h4><ul>
<li>==<code>zip [选项] XXX.zip 要压缩的内容</code>==：压缩，常用选项 ==<code>-r</code>== 递归压缩，即压缩成目录</li>
<li>==<code>zip -r mypackage.zip /home/</code>==：将home目录下所有文件压缩成mypackage.zip文件</li>
<li>==<code>unzip [选项] XXX.zip</code>==：解压缩，常用选项 ==<code>-d 目录</code>== 指定解压后的文件存放目录</li>
</ul>
<h4 id="tar指令"><a href="#tar指令" class="headerlink" title="tar指令"></a>tar指令</h4><p>打包，最后打包的文件是.tar.gz文件</p>
<ul>
<li><p>==<code>tar [选项] XXX.tar.gz 打包的内容</code>==：打包目录，常用选项：</p>
<ul>
<li>==<code>-c</code>== ：产生.tar打包文件</li>
<li>==<code>-v</code>== ：显示详细信息</li>
<li>==<code>-f</code>== ：指定压缩后的文件名</li>
<li>==<code>-z</code>== ：打包同时压缩</li>
<li>==<code>-x</code>== ：解包.tar文件</li>
</ul>
</li>
<li><p>==<code>tar -zcvf a.tar.gz a1.txt a2.txt</code>==：将a1.txt和a2.txt压缩到a.tar.gz中</p>
</li>
<li><p>==<code>tar -zxvf a.tar.gz</code>==：解压a.tar.gz到当前目录</p>
</li>
<li><p>==<code>tar -zxvf a.tar.gz -C /opt/</code>==：解压a.tar.gz到opt目录，指定的目录必需存在</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/16/JS/String/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="llz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="llz's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/16/JS/String/" itemprop="url">JS常用API之----String</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-16T10:05:48+08:00">
                2018-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JS/" itemprop="url" rel="index">
                    <span itemprop="name">JS</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JS/String/" itemprop="url" rel="index">
                    <span itemprop="name">String</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="String"><a href="#String" class="headerlink" title="String"></a>String</h1><h2 id="includes-查找的字符串，-起始位置"><a href="#includes-查找的字符串，-起始位置" class="headerlink" title="includes(查找的字符串，[起始位置])"></a>includes(查找的字符串，[起始位置])</h2><p>返回布尔值，表示是否找到了参数字符串</p>
<h2 id="startsWith-查找的字符串，-起始位置"><a href="#startsWith-查找的字符串，-起始位置" class="headerlink" title="startsWith(查找的字符串，[起始位置])"></a>startsWith(查找的字符串，[起始位置])</h2><p>返回布尔值，表示参数字符串是否在原字符串的头部</p>
<h2 id="endsWith-查找的字符串，-截止位置"><a href="#endsWith-查找的字符串，-截止位置" class="headerlink" title="endsWith(查找的字符串，[截止位置])"></a>endsWith(查找的字符串，[截止位置])</h2><p>返回布尔值，表示参数字符串是否在原字符串的尾部</p>
<h2 id="repeat-重复次数n"><a href="#repeat-重复次数n" class="headerlink" title="repeat(重复次数n)"></a>repeat(重复次数n)</h2><p>返回一个新字符串，表示将原字符串重复<code>n</code>次</p>
<ul>
<li>参数如果是小数，会被取整(舍去小数部分)</li>
<li>参数是负数或者<code>Infinity</code>，会报错  </li>
<li>参数是 0 到-1 之间的小数或者NaN，则等同于 0</li>
<li>参数是字符串，则会先转换成数字<h2 id="padStart-字符串最小长度，-用什么字符串补全"><a href="#padStart-字符串最小长度，-用什么字符串补全" class="headerlink" title="padStart(字符串最小长度，[用什么字符串补全])"></a>padStart(字符串最小长度，[用什么字符串补全])</h2>头部补全，如： <code>&#39;x&#39;.padStart(5, &#39;ab&#39;)     // &#39;ababx&#39;</code></li>
<li>若原字符串的长度，等于或大于指定的最小长度，则返回原字符串</li>
<li>用来补全的字符串与原字符串，两者的长度之和超过了指定的最小长度，则会截去超出位数的补全字符串,如： <code>&#39;abc&#39;.padStart(10, &#39;0123456789&#39;)    // &#39;0123456abc&#39;</code></li>
<li>若省略第二个参数，默认使用空格补全长度<h2 id="padEnd-字符串最小长度，-用什么字符串补全"><a href="#padEnd-字符串最小长度，-用什么字符串补全" class="headerlink" title="padEnd(字符串最小长度，[用什么字符串补全])"></a>padEnd(字符串最小长度，[用什么字符串补全])</h2>尾部补全，其他同上<h2 id="substring-开始位置，-结束位置"><a href="#substring-开始位置，-结束位置" class="headerlink" title="substring(开始位置，[结束位置])"></a>substring(开始位置，[结束位置])</h2><h2 id="substr-开始位置，-长度-ECMAscript-没有对该方法进行标准化，因此反对使用它"><a href="#substr-开始位置，-长度-ECMAscript-没有对该方法进行标准化，因此反对使用它" class="headerlink" title="substr(开始位置，[长度])  ECMAscript 没有对该方法进行标准化，因此反对使用它"></a>substr(开始位置，[长度])  <font color="red">ECMAscript 没有对该方法进行标准化，因此反对使用它</font></h2><h2 id="slice-开始位置，结束位置"><a href="#slice-开始位置，结束位置" class="headerlink" title="slice(开始位置，结束位置)"></a>slice(开始位置，结束位置)</h2><h2 id="split-分隔符"><a href="#split-分隔符" class="headerlink" title="split(分隔符)"></a>split(分隔符)</h2><h2 id="match-searchvalue-regexp"><a href="#match-searchvalue-regexp" class="headerlink" title="match(searchvalue | regexp)"></a>match(searchvalue | regexp)</h2></li>
<li>当参数为regexp时，返回存放匹配结果的数组。该数组的内容依赖于 regexp 是否具有全局标志 g</li>
<li>如果 regexp 没有标志 g，那么 match() 方法就只能在 stringObject 中执行一次匹配。如果没有找到任何匹配的文本， match() 将返回 null。</li>
<li>否则，它将返回一个数组，其中存放了与它找到的匹配文本有关的信息。该数组的第 0 个元素存放的是匹配文本，而其余的元素存放的是与正则表达式的子表达式匹配的文本。</li>
<li>除了这些常规的数组元素之外，返回的数组还含有两个对象属性。index属性声明的是匹配文本的起始字符在 stringObject 中的位置，input属性声明的是对 stringObject 的引用。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//不带修饰符g</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">'http://www.baidu.com?a=1&amp;b=2&amp;c=3'</span>;</span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/([^?&amp;=]+)=([^?&amp;=])*/</span>;</span><br><span class="line"><span class="keyword">var</span> result = url.match(reg);</span><br><span class="line"><span class="built_in">console</span>.log(result); </span><br><span class="line"><span class="comment">//["a=1", "a", "1", index: 21, input: "http://www.baidu.com?a=1&amp;b=2&amp;c=3"]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(result.index); <span class="comment">//21</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(result.input); <span class="comment">//http://www.baidu.com?a=1&amp;b=2&amp;c=3</span></span><br></pre></td></tr></table></figure></li>
<li>如果 regexp 具有标志 g，则 match() 方法将执行全局检索，找到 stringObject 中的所有匹配子字符串。</li>
<li>若没有找到任何匹配的子串，则返回 null。</li>
<li>如果找到了一个或多个匹配子串，则返回一个数组。不过全局匹配返回的数组的内容与前者大不相同，它的数组元素中存放的是 stringObject 中所有的匹配子串，而且也没有 index 属性或 input 属性。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//带修饰符g</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">'http://www.baidu.com?a=1&amp;b=2&amp;c=3'</span>;</span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/([^?&amp;=]+)=([^?&amp;=])*/g</span>;</span><br><span class="line"><span class="keyword">var</span> result = url.match(reg);</span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">//["a=1", "b=2", "c=3"]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(result.index); <span class="comment">//undefined</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(result.input); <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>
<h2 id="replace-regexp-substr-replacement"><a href="#replace-regexp-substr-replacement" class="headerlink" title="replace(regexp/substr,replacement)"></a>replace(regexp/substr,replacement)</h2>返回一个新的字符串，是用 replacement 替换了 regexp 的第一次匹配或所有匹配之后得到的</li>
<li>字符串 stringObject 的 replace() 方法执行的是查找并替换的操作。它将在 stringObject 中查找与 regexp 相匹配的子字符串，然后用 replacement 来替换这些子串。如果 regexp 具有全局标志 g，那么 replace() 方法将替换所有匹配的子串。否则，它只替换第一个匹配子串</li>
<li>replacement 可以是字符串，也可以是函数。如果它是字符串，那么每个匹配都将由字符串替换。但是 replacement 中的 $ 字符具有特定的含义。如下表所示，它说明从模式匹配得到的字符串将用于替换</li>
</ul>
<table>
<thead>
<tr>
<th align="center">字符</th>
<th align="center">替换文本</th>
</tr>
</thead>
<tbody><tr>
<td align="center">$1,$2,…,$99</td>
<td align="center">与regexp中第1个到第99个子表达式相匹配的文本</td>
</tr>
<tr>
<td align="center">$&amp;</td>
<td align="center">与regexp相匹配的子串</td>
</tr>
<tr>
<td align="center">$`</td>
<td align="center">位于匹配子串左侧的文本</td>
</tr>
<tr>
<td align="center">$’</td>
<td align="center">位于匹配子串右侧的文本</td>
</tr>
<tr>
<td align="center">$$</td>
<td align="center">直接量符号(要替换为$符号时，就写2个$)</td>
</tr>
</tbody></table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//不带修饰符g</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">'http://www.baidu.com?a=1&amp;b=2&amp;c=3'</span>;</span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/([^?&amp;=]+)=([^?&amp;=])*/</span>;</span><br><span class="line"><span class="keyword">var</span> url1 = url.replace(reg,<span class="function"><span class="keyword">function</span>(<span class="params">a,b,c,d,e</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(a,b,c,d,e); <span class="comment">//a=1, a, 1, 21, http://www.baidu.com?a=1&amp;b=2&amp;c=3</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'ok'</span>;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(url1); <span class="comment">//http://www.baidu.com?ok&amp;b=2&amp;c=3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//带修饰符g</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">'http://www.baidu.com?a=1&amp;b=2&amp;c=3'</span>;</span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/([^?&amp;=]+)=([^?&amp;=])*/g</span>;</span><br><span class="line"><span class="keyword">var</span> url1 = url.replace(reg,<span class="function"><span class="keyword">function</span>(<span class="params">a,b,c,d,e</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(a,b,c,d,e); </span><br><span class="line"><span class="comment">//执行3次，分别输出为：</span></span><br><span class="line">a=<span class="number">1</span>, a, <span class="number">1</span>, <span class="number">21</span>, <span class="attr">http</span>:<span class="comment">//www.baidu.com?a=1&amp;b=2&amp;c=3 和 </span></span><br><span class="line">b=<span class="number">2</span>, b, <span class="number">2</span>, <span class="number">25</span>, <span class="attr">http</span>:<span class="comment">//www.baidu.com?a=1&amp;b=2&amp;c=3 和 </span></span><br><span class="line">c=<span class="number">3</span>, c, <span class="number">3</span>, <span class="number">29</span>, <span class="attr">http</span>:<span class="comment">//www.baidu.com?a=1&amp;b=2&amp;c=3</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'ok'</span>;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(url1); <span class="comment">//http://www.baidu.com?ok&amp;ok&amp;ok</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//第二个参数为字符串时</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">'http://www.baidu.com?a=1&amp;b=2&amp;c=3'</span>;</span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/([^?&amp;=]+)=([^?&amp;=])*/</span>; <span class="comment">//不带修饰符g</span></span><br><span class="line"><span class="keyword">var</span> url1 = url.replace(reg,<span class="string">"$&amp;"</span>)</span><br><span class="line"><span class="built_in">console</span>.log(url1); <span class="comment">//http://www.baidu.com?a=1&amp;b=2&amp;c=3</span></span><br><span class="line"><span class="keyword">var</span> url1 = url.replace(reg,<span class="string">"$1"</span>)</span><br><span class="line"><span class="built_in">console</span>.log(url1); <span class="comment">//http://www.baidu.com?a&amp;b=2&amp;c=3</span></span><br><span class="line"><span class="keyword">var</span> url1 = url.replace(reg,<span class="string">"$2"</span>)</span><br><span class="line"><span class="built_in">console</span>.log(url1); <span class="comment">//http://www.baidu.com?1&amp;b=2&amp;c=3</span></span><br><span class="line"><span class="keyword">var</span> url1 = url.replace(reg,<span class="string">"$'"</span>)</span><br><span class="line"><span class="built_in">console</span>.log(url1); <span class="comment">//http://www.baidu.com?&amp;b=2&amp;c=3&amp;b=2&amp;c=3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/([^?&amp;=]+)=([^?&amp;=])*/g</span>; <span class="comment">//带修饰符g</span></span><br><span class="line"><span class="keyword">var</span> url1 = url.replace(reg,<span class="string">"$&amp;"</span>)</span><br><span class="line"><span class="built_in">console</span>.log(url1); <span class="comment">//http://www.baidu.com?a=1&amp;b=2&amp;c=3</span></span><br><span class="line"><span class="keyword">var</span> url1 = url.replace(reg,<span class="string">"$1"</span>)</span><br><span class="line"><span class="built_in">console</span>.log(url1); <span class="comment">//http://www.baidu.com?a&amp;b&amp;c</span></span><br><span class="line"><span class="keyword">var</span> url1 = url.replace(reg,<span class="string">"$2"</span>)</span><br><span class="line"><span class="built_in">console</span>.log(url1); <span class="comment">//http://www.baidu.com?1&amp;2&amp;3</span></span><br><span class="line"><span class="keyword">var</span> url1 = url.replace(reg,<span class="string">"$'"</span>)</span><br><span class="line"><span class="built_in">console</span>.log(url1); <span class="comment">//http://www.baidu.com?&amp;b=2&amp;c=3&amp;&amp;c=3&amp;</span></span><br></pre></td></tr></table></figure>







          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/13/JS/Array/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="llz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="llz's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/13/JS/Array/" itemprop="url">JS常用API之----Array</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-13T14:25:43+08:00">
                2018-04-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JS/" itemprop="url" rel="index">
                    <span itemprop="name">JS</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JS/Array/" itemprop="url" rel="index">
                    <span itemprop="name">Array</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h1><h2 id="Array-from-要转为数组的对象，-function-，-绑定this"><a href="#Array-from-要转为数组的对象，-function-，-绑定this" class="headerlink" title="Array.from(要转为数组的对象，[function]，[绑定this])"></a>Array.from(要转为数组的对象，[function]，[绑定this])</h2><ul>
<li>参数2的function类似<code>map()</code>,用来对每个元素进行处理，将处理后的值放入返回的数组</li>
<li>只能将两类对象转为真正的数组：类似数组的对象（array-like object）和可遍历（iterable）的对象（包括 ES6 新增的数据结构 Set 和 Map）<h2 id="Array-of"><a href="#Array-of" class="headerlink" title="Array.of()"></a>Array.of()</h2>构造数组实例，<code>of()</code>可以解决<code>new Array()</code>构造器因参数个数不同，导致的行为有差异的问题(<code>new Array()</code>当参数只有一个数值时，构造函数会把它当成数组的长度)。<br>  如：<code>Array.of(1,2,3) ==&gt; [1,2,3]</code><h2 id="copyWithin-target-start-end-会改变原数组"><a href="#copyWithin-target-start-end-会改变原数组" class="headerlink" title="copyWithin(target,[start],[end])     会改变原数组"></a>copyWithin(target,[start],[end])     <font color="red">会改变原数组</font></h2>浅复制数组的一部分到同一数组中的另一个位置，并返回它，而不修改其大小</li>
<li>target（必需）：复制序列到该位置。如果为负值，表示倒数。如果 target ≥arr.length，将会不发生拷贝。如果 target&lt; start，复制的序列将被修改以符合 arr.length</li>
<li>start（可选）：从该位置开始读取数据，默认为 0。如果为负值，表示倒数。如果 start 被忽略，copyWithin 将会从0开始复制</li>
<li>end（可选）：到该位置前停止读取数据，默认等于数组长度。如果为负值，表示倒数<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].copyWithin(<span class="number">-2</span>);</span><br><span class="line"><span class="comment">// [1, 2, 3, 1, 2]</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].copyWithin(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line"><span class="comment">// [4, 5, 3, 4, 5]</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].copyWithin(<span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="comment">// [4, 2, 3, 4, 5]</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].copyWithin(<span class="number">-2</span>, <span class="number">-3</span>, <span class="number">-1</span>);</span><br><span class="line"><span class="comment">// [1, 2, 3, 3, 4]</span></span><br></pre></td></tr></table></figure>
<h2 id="find-回调函数"><a href="#find-回调函数" class="headerlink" title="find(回调函数)"></a>find(回调函数)</h2>找出第一个符合条件的数组成员，没有返回undefined<h2 id="findIndex-回调函数"><a href="#findIndex-回调函数" class="headerlink" title="findIndex(回调函数)"></a>findIndex(回调函数)</h2>返回第一个符合条件的数组成员的位置，没有返回-1<h2 id="fill-填充的值，-填充起始位置-，-填充结束位置-会改变原数组"><a href="#fill-填充的值，-填充起始位置-，-填充结束位置-会改变原数组" class="headerlink" title="fill(填充的值，[填充起始位置]，[填充结束位置])   会改变原数组"></a>fill(填充的值，[填充起始位置]，[填充结束位置])   <font color="red">会改变原数组</font></h2>使用给定的值填充数组，常用于初始化数组，数组中已有的元素，会被全部抹去<h2 id="遍历array"><a href="#遍历array" class="headerlink" title="遍历array"></a>遍历array</h2><h3 id="keys"><a href="#keys" class="headerlink" title="keys()"></a>keys()</h3><h3 id="values"><a href="#values" class="headerlink" title="values()"></a>values()</h3><h3 id="entries"><a href="#entries" class="headerlink" title="entries()"></a>entries()</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [index, elem] <span class="keyword">of</span> [<span class="string">'a'</span>,<span class="string">'b'</span>].entries()) &#123;                           </span><br><span class="line"> <span class="built_in">console</span>.log(index,elem);  </span><br><span class="line"> <span class="comment">//  0  'a'</span></span><br><span class="line"> <span class="comment">//  1  'b'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> letter = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">let</span> entries = letter.entries();</span><br><span class="line"><span class="built_in">console</span>.log(entries.next().value); <span class="comment">// [0, 'a']</span></span><br><span class="line"><span class="built_in">console</span>.log(entries.next().value); <span class="comment">// [1, 'b']</span></span><br><span class="line"><span class="built_in">console</span>.log(entries.next().value); <span class="comment">// [2, 'c']</span></span><br></pre></td></tr></table></figure>
<h2 id="includes-在数组中查询的值，-起始位置-，-结束位置"><a href="#includes-在数组中查询的值，-起始位置-，-结束位置" class="headerlink" title="includes(在数组中查询的值，[起始位置]，[结束位置])"></a>includes(在数组中查询的值，[起始位置]，[结束位置])</h2>返回一个布尔值，表示某个数组是否包含给定的值<h2 id="reduce-function-prev-cur-index-arr-设置prev的初始类型和初始值"><a href="#reduce-function-prev-cur-index-arr-设置prev的初始类型和初始值" class="headerlink" title="reduce(function(prev,cur,index,arr),设置prev的初始类型和初始值)"></a>reduce(function(prev,cur,index,arr),设置prev的初始类型和初始值)</h2></li>
<li>prev: 第一项的值或者上一次叠加的结果值</li>
<li>cur: 当前会参与叠加的项</li>
<li>index： 当前值的索引</li>
<li>arr: 数组本身<h2 id="filter-function-currentValue-index-arr-thisValue"><a href="#filter-function-currentValue-index-arr-thisValue" class="headerlink" title="filter(function(currentValue,index,arr), thisValue)"></a>filter(function(currentValue,index,arr), thisValue)</h2>创建一个新的数组，新数组中的元素是通过检查指定数组中符合条件的所有元素</li>
<li>currentValue：当前元素的值，必须</li>
<li>index：当前元素索引，可选</li>
<li>arr：当前元素所属数组对象，可选</li>
<li>thisValue：执行该函数的this，可选<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> studentsAge = [<span class="number">17</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">21</span>, <span class="number">17</span>];</span><br><span class="line"><span class="keyword">const</span> ableToDrink = studentsAge.filter( <span class="function"><span class="params">age</span> =&gt;</span> age &gt; <span class="number">18</span> );        </span><br><span class="line"><span class="comment">//  [19,21]</span></span><br></pre></td></tr></table></figure>
<h2 id="map-function-currentValue，index，arr-thisValue"><a href="#map-function-currentValue，index，arr-thisValue" class="headerlink" title="map(function(currentValue，index，arr),thisValue)"></a>map(function(currentValue，index，arr),thisValue)</h2>返回一个新数组，数组中的元素为原始数组元素调用函数处理的后值，参数含义同上<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> dollars = numbers.map( <span class="function"><span class="params">number</span> =&gt;</span> <span class="string">'$'</span> + number);        </span><br><span class="line"><span class="comment">//['$2', '$3', '$4', '$5']</span></span><br></pre></td></tr></table></figure>
<h2 id="forEach-function-currentValue，index，arr-thisValue"><a href="#forEach-function-currentValue，index，arr-thisValue" class="headerlink" title="forEach(function(currentValue，index，arr),thisValue)"></a>forEach(function(currentValue，index，arr),thisValue)</h2><h2 id="some-function-currentValue-index-arr-thisValue-不改变原数组"><a href="#some-function-currentValue-index-arr-thisValue-不改变原数组" class="headerlink" title="some(function(currentValue,index,arr),thisValue)    不改变原数组"></a>some(function(currentValue,index,arr),thisValue)    <font color="red">不改变原数组</font></h2>检测数组中的元素是否满足指定条件</li>
<li>如果有一个元素满足条件，则表达式返回true , 剩余的元素不会再执行检测</li>
<li>如果没有满足条件的元素，则返回false<h2 id="every-function-currentValue-index-arr-thisValue-不改变原数组"><a href="#every-function-currentValue-index-arr-thisValue-不改变原数组" class="headerlink" title="every(function(currentValue,index,arr),thisValue)    不改变原数组"></a>every(function(currentValue,index,arr),thisValue)    <font color="red">不改变原数组</font></h2>检测数组所有元素是否都符合指定条件</li>
<li>如果数组中检测到有一个元素不满足，则整个表达式返回 false ，且剩余的元素不会再进行检测</li>
<li>如果所有元素都满足条件，则返回 true<h2 id="slice-start-end-不改变原数组"><a href="#slice-start-end-不改变原数组" class="headerlink" title="slice(start,end)     不改变原数组"></a>slice(start,end)     <font color="red">不改变原数组</font></h2><h2 id="splice-start-deleteCount-item1-item2-…-会改变原数组"><a href="#splice-start-deleteCount-item1-item2-…-会改变原数组" class="headerlink" title="splice(start[, deleteCount[, item1[, item2[, …]]]])    会改变原数组"></a>splice(start[, deleteCount[, item1[, item2[, …]]]])    <font color="red">会改变原数组</font></h2></li>
<li>start：指定修改的开始位置（从0计数）。如果超出了数组的长度，则从数组末尾开始添加内容；如果是负值，则表示从数组末位开始的第几位（从-1计数）；若只使用start参数而不使用deleteCount、item，表示删除[start，end]的元素</li>
<li>deleteCount (可选)：整数，表示要移除的数组元素的个数。如果 deleteCount 是 0，则不移除元素。这种情况下，至少应添加一个新元素。如果 deleteCount 大于start 之后的元素的总数，则从 start 后面的元素都将被删除（含第 start 位）。如果deleteCount被省略，则其相当于(arr.length - start)</li>
<li>item1, item2, … (可选)：要添加进数组的元素,从start 位置开始。如果不指定，则 splice() 将只删除数组元素</li>
<li>返回值： 由被删除的元素组成的一个数组。如果只删除了一个元素，则返回只包含一个元素的数组。如果没有删除元素，则返回空数组<h2 id="sort-会改变原数组"><a href="#sort-会改变原数组" class="headerlink" title="sort()    会改变原数组"></a>sort()    <font color="red">会改变原数组</font></h2><h2 id="reverse-会改变原数组"><a href="#reverse-会改变原数组" class="headerlink" title="reverse()    会改变原数组"></a>reverse()    <font color="red">会改变原数组</font></h2><h2 id="join-分隔符-不改变原数组"><a href="#join-分隔符-不改变原数组" class="headerlink" title="join(分隔符)    不改变原数组"></a>join(分隔符)    <font color="red">不改变原数组</font></h2>将数组（或一个类数组对象）中所有元素都转化为字符串并使用指定的分隔符(默认分隔符为逗号)连接在一起，返回最后生成的字符串<h2 id="concat-不改变原数组"><a href="#concat-不改变原数组" class="headerlink" title="concat()     不改变原数组"></a>concat()     <font color="red">不改变原数组</font></h2><h2 id="isArray"><a href="#isArray" class="headerlink" title="isArray()"></a>isArray()</h2>判定对象是否为数组，还能通过以下方式判断：<br><code>Object.prototype.toString.call(arg) === &#39;[object Array]&#39;</code></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/24/MySQL/%E8%A7%86%E5%9B%BE&%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="llz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="llz's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/24/MySQL/%E8%A7%86%E5%9B%BE&%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/" itemprop="url">MySQL学习记录之----视图&存储过程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-24T11:05:30+08:00">
                2017-11-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">MySQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><h2 id="含义"><a href="#含义" class="headerlink" title="含义"></a>含义</h2><p>虚拟表，和普通表一样使用，mysql5.1版本出现的新特性，是通过表动态生成的数据，只保存sql逻辑，不保存查询结果<br>|       | 创建语法的关键字 | 是否实际占用物理空间 |           使用           |<br>| :—: | :————–: | :——————: | :———————-: |<br>| 视图  |   create view    | 没有，只保存sql逻辑  | 增删改查，一般不能增删改 |<br>|  表   |   create table   |          有          |         增删改查         |</p>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ul>
<li>多个地方用到同样的查询结果</li>
<li>该查询结果使用的sql语句较复杂<h2 id="视图创建"><a href="#视图创建" class="headerlink" title="视图创建"></a>视图创建</h2><code>create view 视图名 as 查询语句</code><h2 id="好处"><a href="#好处" class="headerlink" title="好处"></a>好处</h2></li>
<li>重用sql语句</li>
<li>简化复杂的sql操作，不必知道它的查询细节</li>
<li>保护数据，提高安全性（使用视图时不知道原始表的信息）<h2 id="视图修改"><a href="#视图修改" class="headerlink" title="视图修改"></a>视图修改</h2>语法1：</li>
</ul>
<p><code>create or replace view 视图名 as 查询语句</code></p>
<p>语法2：</p>
<p><code>alter view 视图名 as 查询语句</code></p>
<h2 id="视图删除"><a href="#视图删除" class="headerlink" title="视图删除"></a>视图删除</h2><p><code>drop view 视图名，视图名...</code></p>
<h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><h2 id="系统变量"><a href="#系统变量" class="headerlink" title="系统变量"></a>系统变量</h2><ul>
<li>全局变量：服务器每次启动将为所有全局变量赋初始值，针对于所有会话(连接)有效，但不能跨重启</li>
<li>会话变量：仅仅针对当前会话(连接)有效</li>
</ul>
<p>变量由系统提供，不是用户定义，属于服务器层面</p>
<ul>
<li>查看所有全局系统变量：<code>show global variables</code></li>
<li>查看所有会话变量：<code>show session variables</code>,其中session可省略</li>
<li>查看满足条件的系统变量：<code>show global/session variables like &#39;%char%&#39;</code></li>
<li>查看指定的某个全局系统变量的值：<code>select @@global.系统变量名</code></li>
<li>查看指定的某个会话系统变量的值：<code>select @@session.系统变量名</code>，其中session可省略</li>
<li>为某个系统变量赋值：<ul>
<li>语法1：<code>set global/session 系统变量名=值</code>,其中global和session都不写默认为session</li>
<li>语法2：<code>set @@global/session.系统变量名=值</code><h2 id="自定义变量"><a href="#自定义变量" class="headerlink" title="自定义变量"></a>自定义变量</h2></li>
</ul>
</li>
<li>用户变量</li>
<li>局部变量</li>
</ul>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">作用域</th>
<th align="center">定义和使用的位置</th>
<th align="center">语法</th>
</tr>
</thead>
<tbody><tr>
<td align="center">用户变量</td>
<td align="center">当前会话</td>
<td align="center">会话中任意位置</td>
<td align="center">必须加@，不用限定类型</td>
</tr>
<tr>
<td align="center">局部变量</td>
<td align="center">begin end中</td>
<td align="center">只能是begin end第一句</td>
<td align="center">一般不用加@，需要限定类型</td>
</tr>
<tr>
<td align="center">### 用户变量</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">针对于当前会话(连接)有效，同会话系统变量的作用域</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">1. 声明并初始化</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> @用户变量名=值</span><br><span class="line"><span class="keyword">set</span> @用户变量名:=值</span><br><span class="line"><span class="keyword">select</span> @用户变量名:=值</span><br></pre></td></tr></table></figure></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">2. 赋值(更新用户变量值)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> @用户变量名=值</span><br><span class="line"><span class="keyword">set</span> @用户变量名:=值</span><br><span class="line"><span class="keyword">select</span> @用户变量名:=值</span><br><span class="line">(要求查询出来的字段必须是一个值)：<span class="keyword">select</span> 字段 <span class="keyword">into</span> 变量名 <span class="keyword">from</span> 表</span><br></pre></td></tr></table></figure></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">3. 使用</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>select @变量名</code></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">### 局部变量</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">仅仅在定义它的begin，end中有效，且必须放在begin，end的第一句</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">1. 声明</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> 变量名 类型</span><br><span class="line"><span class="keyword">declare</span> 变量名 类型 <span class="keyword">default</span> 值</span><br></pre></td></tr></table></figure></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">2. 赋值</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> 局部变量名=值</span><br><span class="line"><span class="keyword">set</span> 局部变量名:=值</span><br><span class="line"><span class="keyword">select</span> @局部变量名:=值</span><br><span class="line">(要求查询出来的字段必须是一个值)：<span class="keyword">select</span> 字段 <span class="keyword">into</span> 局部变量名 <span class="keyword">from</span> 表</span><br></pre></td></tr></table></figure></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">3. 使用</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>select 局部变量名</code></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"># 存储过程</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">## 含义</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">一组预先编译好的sql语句的集合<br></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">好处：</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">- 提高代码重用型</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">- 简化操作</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">- 减少了编译次数和数据库服务器的连接次数，提高了效率</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">## 创建</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> 存储过程名(参数列表)</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line">    存储过程体(一组合法的<span class="keyword">sql</span>语句)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">- 参数列表包含3部分：参数模式，参数名，参数类型，如<code>in stu_name varchar(20)</code>，其中参数模式有如下几种：</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">- in：该参数可以作为输入，即该参数需要调用方传入值</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">- out：该参数可以作为输出，即该参数可以作为返回值</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">- inout：该参数既可以作为输入又可以作为输出</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">- 如果<code>begin end</code>中只有一句话，则<code>begin end</code>关键字可以省略</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">- 存储过程体中每条sql语句结尾必须加分号，存储过程的结尾使用<code>delimiter</code>重新设置，语法：<code>delimiter 结束标记</code>，如<code>delimiter $</code></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">## 调用</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>call 存储过程名(实参列表)</code></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<h2 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h2><h3 id="空参列表"><a href="#空参列表" class="headerlink" title="空参列表"></a>空参列表</h3><p>插入到admin表中1条记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建存储过程</span></span><br><span class="line">delimiter $</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p1()</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">admin</span> <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">"张三"</span>,<span class="number">14</span>)</span><br><span class="line"><span class="keyword">end</span> $</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用</span></span><br><span class="line"><span class="keyword">call</span> p1() $</span><br></pre></td></tr></table></figure>
<h3 id="创建带in参数模式的存储过程"><a href="#创建带in参数模式的存储过程" class="headerlink" title="创建带in参数模式的存储过程"></a>创建带in参数模式的存储过程</h3><p>创建存储过程实现根据员工名字查部门信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p2(<span class="keyword">in</span> <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">select</span> d.*</span><br><span class="line">    <span class="keyword">from</span> dept d</span><br><span class="line">    <span class="keyword">right</span> <span class="keyword">join</span> emps e <span class="keyword">on</span> e.dept_id = b.id</span><br><span class="line">    <span class="keyword">where</span> e.name = <span class="keyword">name</span>；</span><br><span class="line"><span class="keyword">end</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> p2(<span class="string">'张三'</span>) $</span><br></pre></td></tr></table></figure>
<h3 id="创建存储过程带局部变量"><a href="#创建存储过程带局部变量" class="headerlink" title="创建存储过程带局部变量"></a>创建存储过程带局部变量</h3><p>传入用户名密码判断是否登录成功</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p3(<span class="keyword">in</span> username <span class="built_in">varchar</span>(<span class="number">20</span>),<span class="keyword">in</span> <span class="keyword">password</span> <span class="built_in">varchar</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> <span class="keyword">result</span> <span class="built_in">int</span> <span class="keyword">default</span> <span class="number">0</span>;   <span class="comment">#声明并初始化</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">into</span> <span class="keyword">result</span>     <span class="comment">#赋值</span></span><br><span class="line">    <span class="keyword">from</span> <span class="keyword">admin</span> </span><br><span class="line">    <span class="keyword">where</span> admin.username=username</span><br><span class="line">    <span class="keyword">and</span> admin.password=<span class="keyword">password</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">if</span>(<span class="keyword">result</span>&gt;<span class="number">0</span>,<span class="string">'成功'</span>,<span class="string">'失败'</span>)   <span class="comment">#使用</span></span><br><span class="line"><span class="keyword">end</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> p3(<span class="string">'张三'</span>,<span class="string">'12345'</span>) $</span><br></pre></td></tr></table></figure>
<h3 id="创建带out参数模式的存储过程"><a href="#创建带out参数模式的存储过程" class="headerlink" title="创建带out参数模式的存储过程"></a>创建带out参数模式的存储过程</h3><p>根据员工名称查部门名和地址</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p4(<span class="keyword">in</span> emp_name <span class="built_in">varchar</span>(<span class="number">20</span>),<span class="keyword">out</span> dept_name <span class="built_in">varchar</span>(<span class="number">20</span>),<span class="keyword">out</span> dept_address <span class="built_in">varchar</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">select</span> d.name,d.address <span class="keyword">into</span> dept_name,dept_address</span><br><span class="line">    <span class="keyword">from</span> dept d</span><br><span class="line">    <span class="keyword">inner</span> <span class="keyword">join</span> emps e <span class="keyword">on</span> e.dept_id <span class="keyword">on</span> d.id</span><br><span class="line">    <span class="keyword">where</span> e.name=emp_name</span><br><span class="line"><span class="keyword">end</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> p4(<span class="string">'张三'</span>,@<span class="keyword">name</span>,@address) $</span><br><span class="line"><span class="keyword">select</span> @<span class="keyword">name</span>,@address$</span><br></pre></td></tr></table></figure>
<h3 id="创建带inout参数模式的存储过程"><a href="#创建带inout参数模式的存储过程" class="headerlink" title="创建带inout参数模式的存储过程"></a>创建带inout参数模式的存储过程</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p5(inout a <span class="built_in">int</span>,inout b <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">set</span> a=a*<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">set</span> b=b*<span class="number">2</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> @m=<span class="number">10</span>$</span><br><span class="line"><span class="keyword">set</span> @n=<span class="number">20</span>$</span><br><span class="line"><span class="keyword">call</span> p5(@m,@n)$</span><br><span class="line"><span class="keyword">select</span> @m,@n$</span><br></pre></td></tr></table></figure>
<h2 id="删除存储过程"><a href="#删除存储过程" class="headerlink" title="删除存储过程"></a>删除存储过程</h2><p><code>drop procedure 存储过程名</code></p>
<h2 id="查看存储过程结构"><a href="#查看存储过程结构" class="headerlink" title="查看存储过程结构"></a>查看存储过程结构</h2><p><code>show create procedure 存储过程名</code></p>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><ul>
<li>存储过程可以0个返回，也可以多个返回，适合批量插入，批量更新</li>
<li>函数有且仅有1个返回，适合做处理数据后返回一个结果<h2 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> 函数名(参数列表) <span class="keyword">returns</span> 返回类型</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    函数体</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></li>
<li>参数列表包含2部分：参数名 参数类型</li>
<li>函数体必须有<code>return</code>语句</li>
<li>函数体中只有一句话，可以省略<code>begin end</code></li>
<li>使用<code>delimiter 结束标记</code>设置结束标记<h2 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h2><code>select 函数名(参数列表)</code><h2 id="demo-1"><a href="#demo-1" class="headerlink" title="demo"></a>demo</h2><h3 id="无参"><a href="#无参" class="headerlink" title="无参"></a>无参</h3>返回员工个数<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> f1() <span class="keyword">returns</span> <span class="built_in">int</span></span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line">    <span class="keyword">declare</span> <span class="keyword">num</span> <span class="built_in">int</span> <span class="keyword">default</span> <span class="number">0</span>;  <span class="comment">#定义局部变量    </span></span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">into</span> <span class="keyword">num</span>    <span class="comment">#赋值     </span></span><br><span class="line">    <span class="keyword">from</span> emps;</span><br><span class="line">    return num;</span><br><span class="line"><span class="keyword">end</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> f1()$</span><br></pre></td></tr></table></figure>
<h3 id="有参"><a href="#有参" class="headerlink" title="有参"></a>有参</h3>根据员工名查工资<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> f2(emp_name <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">returns</span> <span class="keyword">double</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">set</span> @sal=<span class="number">0</span>;     <span class="comment">#定义用户变量</span></span><br><span class="line">    <span class="keyword">select</span> salary <span class="keyword">into</span> @sal     <span class="comment">#赋值</span></span><br><span class="line">    <span class="keyword">from</span> emps</span><br><span class="line">    <span class="keyword">where</span> emp_name=emps.emp_name;</span><br><span class="line">    return @sal;</span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> f2(<span class="string">'张三'</span>)$</span><br></pre></td></tr></table></figure>
<h2 id="查看函数"><a href="#查看函数" class="headerlink" title="查看函数"></a>查看函数</h2><code>show create function 函数名</code><h2 id="删除函数"><a href="#删除函数" class="headerlink" title="删除函数"></a>删除函数</h2><code>drop function 函数名</code></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/12/MySQL/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B&%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E7%BB%93%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="llz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="llz's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/12/MySQL/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B&%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E7%BB%93%E6%9E%84/" itemprop="url">MySQL学习记录之----数据类型&流程控制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-12T16:50:23+08:00">
                2017-11-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">MySQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="数值型"><a href="#数值型" class="headerlink" title="数值型"></a>数值型</h1><h2 id="整型"><a href="#整型" class="headerlink" title="整型"></a>整型</h2><table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">字节</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Tinyint</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">Smallint</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">Mediumint</td>
<td align="center">3</td>
</tr>
<tr>
<td align="center">Int/integer</td>
<td align="center">4</td>
</tr>
<tr>
<td align="center">Bigint</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">- 如果不设置是无符号还是有符号，默认为有符号，如需设置为无符号，使用<code>unsigned</code>关键字</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">- 如果插入的数值不在整型范围内，会报out of range，并插入临界值</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">- 如果不设置长度，int有符号默认为11，int无符号默认为10，该长度不表示插入数值的范围</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">## 小数</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">类型</td>
<td align="center">字节</td>
</tr>
<tr>
<td align="center">:-:</td>
<td align="center">:-:</td>
</tr>
<tr>
<td align="center">浮点型float(M,D)</td>
<td align="center">4</td>
</tr>
<tr>
<td align="center">浮点型double(M,D)</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">定点型dec(M,D)/定点型decimal(M,D)</td>
<td align="center">m+2</td>
</tr>
<tr>
<td align="center">- M：整数部分+小数部分的总位数</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">- D：小数部分的最大位数</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">- 如果超过范围，则插入临界值</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">- M和D都可以省略，省略时float和double无限制，decimal默认M=10，D=0</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">- 定点型精确度较高，如果要求插入数值的精度，如货币运算优先使用decimal</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">### 浮点型</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">### 定点型</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">最大取值范围域double相同，给定decimal的有效取值范围由M和D决定</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">## 字符型</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">### 较短的文本</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">类型</td>
<td align="center">范围</td>
</tr>
<tr>
<td align="center">:-:</td>
<td align="center">:-:</td>
</tr>
<tr>
<td align="center">char()</td>
<td align="center">0~255个字符</td>
</tr>
<tr>
<td align="center">varchar()</td>
<td align="center">0~65535个字符</td>
</tr>
</tbody></table>
<h3 id="较短的二进制"><a href="#较短的二进制" class="headerlink" title="较短的二进制"></a>较短的二进制</h3><p>binary和varbinary用于保存较短的二进制</p>
<h3 id="枚举类型enum"><a href="#枚举类型enum" class="headerlink" title="枚举类型enum"></a>枚举类型enum</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名(</span><br><span class="line">    列名 enum(<span class="string">'a'</span>,<span class="string">'b'</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>上述写法则表示该列只能插入a，b，A，B这几个值</p>
<h3 id="集合类型set"><a href="#集合类型set" class="headerlink" title="集合类型set"></a>集合类型set</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名(</span><br><span class="line">    列名 <span class="keyword">set</span>(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 <span class="keyword">values</span>(<span class="string">'a'</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 <span class="keyword">values</span>(<span class="string">'a,b'</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 <span class="keyword">values</span>(<span class="string">'a,b,d'</span>)</span><br></pre></td></tr></table></figure>
<p>同样不区分大小写</p>
<h2 id="日期型"><a href="#日期型" class="headerlink" title="日期型"></a>日期型</h2><table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">字节</th>
<th align="center">最小值</th>
<th align="center">最大值</th>
</tr>
</thead>
<tbody><tr>
<td align="center">date</td>
<td align="center">4</td>
<td align="center">1000-01-01</td>
<td align="center">9999-12-31</td>
</tr>
<tr>
<td align="center">datetime</td>
<td align="center">8</td>
<td align="center">1000-01-01 00:00:00</td>
<td align="center">9999-12-31 23:59:59</td>
</tr>
<tr>
<td align="center">timestamp</td>
<td align="center">4</td>
<td align="center">1970 01 01 08 00 01</td>
<td align="center">2038年的某个时刻</td>
</tr>
<tr>
<td align="center">time</td>
<td align="center">3</td>
<td align="center">-838:59:59</td>
<td align="center">838:59:59</td>
</tr>
<tr>
<td align="center">year</td>
<td align="center">1</td>
<td align="center">1901</td>
<td align="center">2155</td>
</tr>
<tr>
<td align="center">- timestamp和实际时区有关，更能反映实际的日期，而datetime则只能反映插入时的当地时区</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">- timestamp的属性受mysql版本和SQLMode的影响很大</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"># 流程控制结构</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">## 分支结构</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">### if函数</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">实现简单的双分支，语法：</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<p><code>select if(表达式1，表达式2，表达式3)</code></p>
<p>执行顺序：表达式1为true，返回表达式2的值，为false，返回表达式3的值</p>
<h3 id="case结构"><a href="#case结构" class="headerlink" title="case结构"></a>case结构</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">case 变量|表达式|字段</span><br><span class="line">when 要判断的值 then 返回的值1或语句1</span><br><span class="line">when 要判断的值 then 返回的值2或语句2</span><br><span class="line">...</span><br><span class="line">else 要返回的值n或语句n</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>其中else可以省略，若省略else，则所有when条件都不满足时返回<code>null</code></p>
<h3 id="if结构"><a href="#if结构" class="headerlink" title="if结构"></a>if结构</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if 条件1 then 语句1</span><br><span class="line">elseif 条件2 then 语句2</span><br><span class="line">...</span><br><span class="line">else 语句n</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">if</span></span><br></pre></td></tr></table></figure>
<p>其中else可以省略,且只能用于<code>begin end</code>中</p>
<h2 id="循环结构"><a href="#循环结构" class="headerlink" title="循环结构"></a>循环结构</h2><p>循环控制：</p>
<ul>
<li>iterate：等同java中的continue  </li>
<li>leave：等同java中的break<h3 id="while"><a href="#while" class="headerlink" title="while"></a>while</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">循环名称:while 循环条件 <span class="keyword">do</span></span><br><span class="line">    循环体</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">while</span> 循环名称;</span><br></pre></td></tr></table></figure>
其中循环名称可以省略，当用到<code>iterate</code>和<code>leave</code>时必须加循环名称<h3 id="loop"><a href="#loop" class="headerlink" title="loop"></a>loop</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">循环名称:loop</span><br><span class="line">    循环体</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">loop</span> 循环名称;</span><br></pre></td></tr></table></figure>
其中循环名称可以省略<h3 id="repeat"><a href="#repeat" class="headerlink" title="repeat"></a>repeat</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">循环名称:repeat</span><br><span class="line">    循环体</span><br><span class="line">until 结束循环条件</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">repeat</span> 循环名称;</span><br></pre></td></tr></table></figure>
<h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3>批量插入，根据次数插入到admin表多条数据，次数&gt;20停止<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">create procedure p1(in insertCount int)</span><br><span class="line">begin </span><br><span class="line">    declare i int default 1;</span><br><span class="line">    a:while i&lt;=insertCount do</span><br><span class="line">        insert into admin(username,password) values(concat(&apos;张三&apos;,i),&apos;123456&apos;);</span><br><span class="line">        if i&gt;=20 then leave a;</span><br><span class="line">        end if</span><br><span class="line">        set i=i+1;</span><br><span class="line">    end while a;    </span><br><span class="line">end $</span><br><span class="line"></span><br><span class="line">call p1(100)$</span><br></pre></td></tr></table></figure>


</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/12/MySQL/TCL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="llz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="llz's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/12/MySQL/TCL/" itemprop="url">MySQL学习记录之----事务</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-12T14:46:32+08:00">
                2017-11-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">MySQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="事务控制语言Transaction-Control-Language"><a href="#事务控制语言Transaction-Control-Language" class="headerlink" title="事务控制语言Transaction Control Language"></a>事务控制语言Transaction Control Language</h1><h2 id="Mysql存储引擎"><a href="#Mysql存储引擎" class="headerlink" title="Mysql存储引擎"></a>Mysql存储引擎</h2><p><code>show engines</code>查看mysql支持的存储引擎</p>
<ul>
<li><p>在mysql中用的最多的存储引擎有：innodb，myisam，memory等</p>
</li>
<li><p>innodb支持事务，myisam,memory不支持事务</p>
<h2 id="事务概念"><a href="#事务概念" class="headerlink" title="事务概念"></a>事务概念</h2><p>一组要么同时执行成功，要么同时执行失败的SQL语句，是数据库操作的一个执行单元</p>
</li>
<li><p>事务开始于：</p>
<ul>
<li>连接到数据库上，并执行一条DML语句(INSERT，UPDATE，DELETE)</li>
<li>前一个事务结束后又输入另一条DML语句</li>
</ul>
</li>
<li><p>事务结束于：</p>
<ul>
<li>执行COMMIT或ROLLBACK语句</li>
<li>执行一条DDL语句，如CREATE TABLE语句，这种情况下会自动执行COMMIT语句</li>
<li>执行一条DCL语句，如GRANT语句，这种情况下会自动执行COMMIT语句</li>
<li>断开与数据库的连接</li>
<li>执行了一条DML语句但失败了，这种情况下会为这个无效的DML语句执行ROLLBACK语句<h2 id="事务ACID"><a href="#事务ACID" class="headerlink" title="事务ACID"></a>事务ACID</h2></li>
</ul>
</li>
<li><p>atomicity(原子性)：表示一个事务内所有操作是一个整体，要么全部成功，要么全部失败</p>
</li>
<li><p>consistency(一致性)：事务必须使数据库从一个一致性状态变换到另一个一致性状态，也就是说一个事务执行之前和执行之后都必须处于一致性状态,以转账来说，假设用户A和用户B两者的钱加起来一共是5000，那么不管A和B之间如何转账，转几次账，事务结束后两个用户的钱相加起来应该还得是5000，这就是事务的一致性</p>
</li>
<li><p>isolation(隔离性)：当多个用户并发访问数据库时，比如操作同一张表时，数据库为每一个用户开启的事务，不能被其他事务的操作所干扰，多个并发事务之间要相互隔离,对于任意两个并发的事务T1和T2，在事务T1看来，T2要么在T1开始之前就已经结束，要么在T1结束之后才开始，这样每个事务都感觉不到有其他事务在并发地执行</p>
</li>
<li><p>durability(持久性)：持久性事务完成后，它对于系统的影响是永久性的，例如我们在使用JDBC操作数据库时，在提交事务方法后，提示用户事务操作完成，当我们程序执行完成直到看到提示后，就可以认定事务以及正确提交，即使这时候数据库出现了问题，也必须要将我们的事务完全执行完成，否则就会造成我们看到提示事务处理完毕，但是数据库因为故障而没有执行事务的重大错误</p>
<h2 id="事务创建"><a href="#事务创建" class="headerlink" title="事务创建"></a>事务创建</h2><h3 id="隐示事务"><a href="#隐示事务" class="headerlink" title="隐示事务"></a>隐示事务</h3><p>事务没有明显的开启和结束标记，如<code>insert</code>,<code>update</code>,<code>delete</code>语句</p>
<h3 id="显示事务"><a href="#显示事务" class="headerlink" title="显示事务"></a>显示事务</h3><p>事务具有明显的开启和结束标记</p>
</li>
<li><p>前提：必须先设置自动提交功能为禁用，<code>set autocommit=0</code><br>显示事务步骤：</p>
</li>
</ul>
<ol>
<li><code>set autocommit=0</code>,禁用自动提交功能</li>
<li><code>start transaction</code>，开启事务，该步可省略</li>
<li>编写事务中的sql，如<code>select</code>，<code>insert</code>，<code>update</code></li>
<li><code>commit</code>,提交事务，<code>rollback</code>，回滚事务<h2 id="事务并发问题"><a href="#事务并发问题" class="headerlink" title="事务并发问题"></a>事务并发问题</h2><h3 id="脏读"><a href="#脏读" class="headerlink" title="脏读"></a>脏读</h3>对于2个事务T1，T2，T1读取了已经被T2更新但还没有被提交的字段,若T2回滚，则T1读取的内容就是临时且无效的<h3 id="不可重复读"><a href="#不可重复读" class="headerlink" title="不可重复读"></a>不可重复读</h3>对于2个事务T1，T2，T1读取了一个字段，然后T2更新了该字段，T1再次读取同一个字段值就不同了<h3 id="幻读"><a href="#幻读" class="headerlink" title="幻读"></a>幻读</h3>对于2个事务T1，T2，T1从一个表中读取了一个字段，然后T2在该表中插入了一些新的行，如果T1再次读取同一个表就会多出几行数据<h2 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h2><table>
<thead>
<tr>
<th align="center">隔离级别</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">read uncommitted(读未提交的数据)</td>
<td align="center">允许事务读取未被其他事务提交的变更，脏读，不可重复读，幻读的问题都会出现</td>
</tr>
<tr>
<td align="center">read committed(读已提交的数据)</td>
<td align="center">只允许事务读取已被其他事务提交的变更，可避免脏读，但不可重复读，幻读的问题可能出现</td>
</tr>
<tr>
<td align="center">repeatable read(可重复读)</td>
<td align="center">确保事务可以多次从一个字段中读取相同的值，在这个事务持续期间内，禁止其他事务对这个字段进行更新，可避免脏读和不可重复读，但幻读的问题可能出现</td>
</tr>
<tr>
<td align="center">serializable(串行化)</td>
<td align="center">确保事务可以从一个表中读取相同的行，在这个事务持续期间内，禁止其他事务对该表执行插入，更新和删除，所有并发问题都可以避免，但性能低下</td>
</tr>
</tbody></table>
</li>
</ol>
<ul>
<li>oracle支持2种事务隔离级别：<code>read committed</code>,<code>serializable</code>。oracle默认的事务隔离级别为<code>read committed</code></li>
<li>mysql支持4种事务隔离级别，mysql默认的事务隔离级别为<code>repeatable read</code><h3 id="查看默认隔离级别"><a href="#查看默认隔离级别" class="headerlink" title="查看默认隔离级别"></a>查看默认隔离级别</h3><code>select @@tx_isolation</code><h3 id="设置隔离级别"><a href="#设置隔离级别" class="headerlink" title="设置隔离级别"></a>设置隔离级别</h3>设置当前mysql连接的隔离级别</li>
</ul>
<p><code>set session transaction isolation level 事务隔离级别</code></p>
<p>设置数据库系统全局的隔离级别</p>
<p><code>set global transaction isolation level 事务隔离级别</code></p>
<h2 id="保存点savepoint"><a href="#保存点savepoint" class="headerlink" title="保存点savepoint"></a>保存点savepoint</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> autocommit=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> emps <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">savepoint</span> a;  <span class="comment">#设置保存点</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> emps <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">2</span>;</span><br><span class="line"><span class="keyword">rollback</span> <span class="keyword">to</span> a;  <span class="comment">#回滚到保存点</span></span><br></pre></td></tr></table></figure>

























          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/24/MySQL/DQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="llz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="llz's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/24/MySQL/DQL/" itemprop="url">MySQL学习记录之----DQL语句</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-24T09:36:45+08:00">
                2017-10-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">MySQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="DQL"><a href="#DQL" class="headerlink" title="DQL"></a>DQL</h1><h2 id="常用API"><a href="#常用API" class="headerlink" title="常用API"></a>常用API</h2><h3 id="单行函数"><a href="#单行函数" class="headerlink" title="单行函数"></a>单行函数</h3><h4 id="字符函数"><a href="#字符函数" class="headerlink" title="字符函数"></a>字符函数</h4><h5 id="号"><a href="#号" class="headerlink" title="+号"></a>+号</h5><p>+号只能作为运算符</p>
<ul>
<li>2边操作数一方为字符型，一方为数值型，则将字符型转换为数值型，若转换成功，继续做加法运算，转换失败，则将字符型数值转为0</li>
<li>一方为null，则结果为null<h5 id="concat"><a href="#concat" class="headerlink" title="concat()"></a>concat()</h5>拼接<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">concat</span>(last_name,first_name) <span class="keyword">as</span> 姓名 <span class="keyword">FROM</span> emps;</span><br></pre></td></tr></table></figure>
<h5 id="ifnull-expr1-expr2"><a href="#ifnull-expr1-expr2" class="headerlink" title="ifnull(expr1,expr2)"></a>ifnull(expr1,expr2)</h5></li>
<li>expr1：要判断是否为空的字段</li>
<li>expr2：如果为null返回expr2的值<h5 id="length-expr"><a href="#length-expr" class="headerlink" title="length(expr)"></a>length(expr)</h5>若为utf-8，中文占3个字节，若为gbk，中文占2个字节</li>
<li>expr：字段名<h5 id="upper-expr-和lower-expr"><a href="#upper-expr-和lower-expr" class="headerlink" title="upper(expr)和lower(expr)"></a>upper(expr)和lower(expr)</h5>大小写转化<h5 id="substr-str-begin-length"><a href="#substr-str-begin-length" class="headerlink" title="substr(str,begin,length)"></a>substr(str,begin,length)</h5><font color="red">
索引从1开始
</font>     

</li>
</ul>
<p>其中length参数可省略</p>
<h5 id="instr-str-substr"><a href="#instr-str-substr" class="headerlink" title="instr(str,substr)"></a>instr(str,substr)</h5><p>返回子串substr在str中第一次出现的起始索引，如果没有返回0</p>
<h5 id="trim"><a href="#trim" class="headerlink" title="trim()"></a>trim()</h5><ul>
<li>只传一个参数str，则去掉str的前后空格</li>
<li>trim(char from str)：去掉str中前后的char字符，char可以为多个字符<h5 id="Lpad-str-length-char"><a href="#Lpad-str-length-char" class="headerlink" title="Lpad(str,length,char)"></a>Lpad(str,length,char)</h5>使用指定的char字符将str左填充到长度为length(字符填充到str左边),若str本身长度大于length，则只保留length长度的str，后面部分去掉<h5 id="Rpad-str-lengtg-char"><a href="#Rpad-str-lengtg-char" class="headerlink" title="Rpad(str,lengtg,char)"></a>Rpad(str,lengtg,char)</h5>右填充，其余同上<h5 id="replace-str-substr-str2"><a href="#replace-str-substr-str2" class="headerlink" title="replace(str,substr,str2)"></a>replace(str,substr,str2)</h5>使用str2替换在str中的所有substr<h4 id="数值函数"><a href="#数值函数" class="headerlink" title="数值函数"></a>数值函数</h4><h5 id="rand"><a href="#rand" class="headerlink" title="rand()"></a>rand()</h5>产生0到1之间的随机数<h5 id="round-num，digit"><a href="#round-num，digit" class="headerlink" title="round(num，digit)"></a>round(num，digit)</h5>四舍五入</li>
<li>若省略digit，则四舍五入到整数</li>
<li>若指定digit，则表示四舍五入到第几位小数<h5 id="ceil-num"><a href="#ceil-num" class="headerlink" title="ceil(num)"></a>ceil(num)</h5>上取整<h5 id="floor-num"><a href="#floor-num" class="headerlink" title="floor(num)"></a>floor(num)</h5>下取整<h5 id="truncate-num-digit"><a href="#truncate-num-digit" class="headerlink" title="truncate(num,digit)"></a>truncate(num,digit)</h5>截断，截取小数点前digit位</li>
<li>digit=0，只取整数部分</li>
<li>digit&lt;0<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">TRUNCATE</span>(<span class="number">11.234</span>,<span class="number">-1</span>)   <span class="comment">------&gt;   10</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">TRUNCATE</span>(<span class="number">11.234</span>,<span class="number">-2</span>)   <span class="comment">------&gt;   0</span></span><br></pre></td></tr></table></figure>
<h5 id="mod-num1-num2"><a href="#mod-num1-num2" class="headerlink" title="mod(num1,num2)"></a>mod(num1,num2)</h5>相当于num1 % num2，取余，结果为num1 - num1 / num2 * num2 <h4 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h4><h5 id="now"><a href="#now" class="headerlink" title="now()"></a>now()</h5>返回当前系统日期和时间<h5 id="curdate"><a href="#curdate" class="headerlink" title="curdate()"></a>curdate()</h5>返回当前系统日期，不包含时间<h5 id="curtime"><a href="#curtime" class="headerlink" title="curtime()"></a>curtime()</h5>返回当前时间，不包含日期<h5 id="获取指定部分的年，月，日，时，分，秒"><a href="#获取指定部分的年，月，日，时，分，秒" class="headerlink" title="获取指定部分的年，月，日，时，分，秒"></a>获取指定部分的年，月，日，时，分，秒</h5></li>
<li>year(now()) ： 获取当前的年份</li>
<li>month(now()) ： 获取当前月份</li>
<li>monthname(now()) ： 获取当前月份的英文表示</li>
<li>day(now()) ： 获取当前的日</li>
<li>hour(now()) ： 获取当前的时</li>
<li>minute(now()) ： 获取当前的分</li>
<li>second(now()) ： 获取当前的秒<h5 id="str-to-date-str-fmt"><a href="#str-to-date-str-fmt" class="headerlink" title="str_to_date(str,fmt)"></a>str_to_date(str,fmt)</h5>将日期格式的str字符串转换成指定格式fmt的日期<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str_to_date('9-13-1999','%m-%d-%Y')     <span class="comment">----&gt;   1999-09-13</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th align="center">序号</th>
<th align="center">格式符</th>
<th align="center">功能</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">%Y</td>
<td align="center">四位的年份</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">%y</td>
<td align="center">二位的年份</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">%m</td>
<td align="center">月份(01,02…11,12)</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">%c</td>
<td align="center">月份(1,2…11,12)</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">%d</td>
<td align="center">日(01,02…)</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">%H</td>
<td align="center">小时(24小时制)</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">%h</td>
<td align="center">小时(12小时制)</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">%i</td>
<td align="center">分钟(00,01…59)</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">%s</td>
<td align="center">秒(00,01…59)</td>
</tr>
<tr>
<td align="center">##### date_format(date,fmt)</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">将日期date转换为指定格式fmt的字符串</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date_format('2018/6/6','%Y年%m月%d日')      <span class="comment">----&gt;   2018年06月06日</span></span><br></pre></td></tr></table></figure></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">#### 其他函数</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">##### version()</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">查看当前数据库版本号</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">##### database()</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">查看当前使用的数据库</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">##### user()</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">查看当前用户</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">#### 流程控制函数</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">##### if(exp1,exp2,exp3)</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">若exp1表达式为真，则执行exp2，否则执行exp3</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">##### case</td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
</li>
<li>语法1如下：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">case 要判断的字段或表达式</span><br><span class="line">when 常量1 then 要显示的值1或语句1</span><br><span class="line">when 常量2 then 要显示的值2或语句2</span><br><span class="line">...</span><br><span class="line">else 要显示的值n或语句n</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></li>
<li>语法2如下：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">case </span><br><span class="line">when 条件1 then 要显示的值1或语句1</span><br><span class="line">when 条件2 then 要显示的值2或语句2</span><br><span class="line">...</span><br><span class="line">else 要显示的值n或语句n</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="分组函数"><a href="#分组函数" class="headerlink" title="分组函数"></a>分组函数</h3>用作统计使用，又称聚合函数或统计函数或组函数   </li>
</ul>
<p>特点：</p>
<ul>
<li>sum，avg用于处理数值型，max,min,count可以处理任何类型</li>
<li>以上分组函数统计时都忽略null值</li>
<li>可以和distinct配合使用</li>
<li>和分组函数一同查询的字段要求是group by后的字段</li>
<li>当使用group by后，select后的分组函数的结果也会按照分组后的情况分别进行统计</li>
<li>group by可以按多个字段分组，多字段的顺序不影响查询结果<h4 id="sum-field"><a href="#sum-field" class="headerlink" title="sum(field)"></a>sum(field)</h4><h4 id="avg-field"><a href="#avg-field" class="headerlink" title="avg(field)"></a>avg(field)</h4><h4 id="max-field"><a href="#max-field" class="headerlink" title="max(field)"></a>max(field)</h4><h4 id="min-field"><a href="#min-field" class="headerlink" title="min(field)"></a>min(field)</h4><h4 id="count-field"><a href="#count-field" class="headerlink" title="count(field)"></a>count(field)</h4><h2 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h2></li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>数据源</th>
<th>位置</th>
<th>关键字</th>
</tr>
</thead>
<tbody><tr>
<td>分组前筛选</td>
<td>原始表</td>
<td>group by子句前</td>
<td>where</td>
</tr>
<tr>
<td>分组后筛选</td>
<td>分组后的结果集</td>
<td>group by子句后</td>
<td>having</td>
</tr>
</tbody></table>
<h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><ul>
<li>sql92标准：仅仅支持内连接</li>
<li>sql99标准(推荐)：支持内连接 + 外连接(左外和右外) + 交叉连接<h3 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h3><h4 id="sql92语法"><a href="#sql92语法" class="headerlink" title="sql92语法"></a>sql92语法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询列表</span><br><span class="line"><span class="keyword">from</span> 表<span class="number">1</span>，表<span class="number">2</span></span><br><span class="line"><span class="keyword">where</span> 查询条件</span><br></pre></td></tr></table></figure>
<h4 id="sql99语法"><a href="#sql99语法" class="headerlink" title="sql99语法"></a>sql99语法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询列表</span><br><span class="line"><span class="keyword">from</span> 表<span class="number">1</span> 别名 [连接类型] <span class="keyword">join</span> 表<span class="number">2</span> 别名</span><br><span class="line"><span class="keyword">on</span> 连接条件</span><br><span class="line"><span class="keyword">where</span> 筛选条件</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> 分组</span><br><span class="line"><span class="keyword">having</span> 分组后筛选条件</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> 排序列表</span><br></pre></td></tr></table></figure></li>
<li>sql99中内连接:inner join，当内连接时inner可以省略</li>
<li>sql99中左外连接:left outer join</li>
<li>sql99中右外连接:right outer join</li>
<li>全外连接:full outer join</li>
<li>sql99中交叉连接:cross join<h4 id="等值连接"><a href="#等值连接" class="headerlink" title="等值连接"></a>等值连接</h4>连接条件用=<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> emp.name,dept.name</span><br><span class="line"><span class="keyword">from</span> emp,dept</span><br><span class="line"><span class="keyword">where</span> emp.dept_id = dept.id</span><br></pre></td></tr></table></figure>
<h4 id="非等值连接"><a href="#非等值连接" class="headerlink" title="非等值连接"></a>非等值连接</h4>连接条件不是=<h4 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h4>demo：查询员工和对应上级名称(员工和上级在同一张表)  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.emp_id,e.name,m.emp_id,m.name</span><br><span class="line"><span class="keyword">from</span> employees e,employees m</span><br><span class="line"><span class="keyword">where</span> e.manager_id = m.emp_id</span><br></pre></td></tr></table></figure>
<h3 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h3><h4 id="左外连接-left-outer-join"><a href="#左外连接-left-outer-join" class="headerlink" title="左外连接  left outer join"></a>左外连接  left outer join</h4><h4 id="右外连接-right-outer-join"><a href="#右外连接-right-outer-join" class="headerlink" title="右外连接  right outer join"></a>右外连接  right outer join</h4><h4 id="全外连接-full-outer-join"><a href="#全外连接-full-outer-join" class="headerlink" title="全外连接  full outer join"></a>全外连接  full outer join</h4><h3 id="交叉连接-cross-join"><a href="#交叉连接-cross-join" class="headerlink" title="交叉连接   cross join"></a>交叉连接   cross join</h3>结果为2表的笛卡尔乘积<h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><h3 id="单行子查询"><a href="#单行子查询" class="headerlink" title="单行子查询"></a>单行子查询</h3><h3 id="多行子查询（一列多行）"><a href="#多行子查询（一列多行）" class="headerlink" title="多行子查询（一列多行）"></a>多行子查询（一列多行）</h3><h4 id="IN"><a href="#IN" class="headerlink" title="IN"></a>IN</h4>等于列表中的任意一个<h4 id="NOT-IN"><a href="#NOT-IN" class="headerlink" title="NOT IN"></a>NOT IN</h4>不等于列表中的任意一个<h4 id="ANY-SOME"><a href="#ANY-SOME" class="headerlink" title="ANY/SOME"></a>ANY/SOME</h4>和子查询返回的某一个值比较<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a &gt; ANY(10,20,30)   //a大于任意一个值就ok</span><br></pre></td></tr></table></figure>
<h4 id="ALL"><a href="#ALL" class="headerlink" title="ALL"></a>ALL</h4>和子查询返回的所有值比较<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a &gt; ALL(10,20,30)   //a需要大于所有值</span><br></pre></td></tr></table></figure>
<h3 id="行子查询-一行多列"><a href="#行子查询-一行多列" class="headerlink" title="行子查询(一行多列)"></a>行子查询(一行多列)</h3>demo:查询员工编号最小工资最高的员工信息<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * </span><br><span class="line"><span class="keyword">from</span> emps</span><br><span class="line"><span class="keyword">where</span> (emps.id,salary) = (</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">min</span>(<span class="keyword">id</span>),<span class="keyword">max</span>(salary)</span><br><span class="line">    <span class="keyword">from</span> emps</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="exists-子查询语句"><a href="#exists-子查询语句" class="headerlink" title="exists(子查询语句)"></a>exists(子查询语句)</h3></li>
<li>使用exists(子查询语句)判断子查询结果集是否为空，不为空返回1，为空返回0</li>
<li>上述其他子查询先执行，使用exists包裹的子查询后执行<h2 id="分页查询limit"><a href="#分页查询limit" class="headerlink" title="分页查询limit"></a>分页查询limit</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询列表</span><br><span class="line"><span class="keyword">from</span> 表</span><br><span class="line">[连接类型] <span class="keyword">join</span> 表<span class="number">2</span></span><br><span class="line"><span class="keyword">on</span> 连接条件</span><br><span class="line"><span class="keyword">where</span> 筛选条件</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> 分组字段</span><br><span class="line"><span class="keyword">having</span> 分组后的筛选</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> 排序的字段</span><br><span class="line"><span class="keyword">limit</span> <span class="keyword">offset</span>,<span class="keyword">size</span></span><br></pre></td></tr></table></figure></li>
<li>offset：起始索引(从0开始)</li>
<li>size：条数<h2 id="联合查询union"><a href="#联合查询union" class="headerlink" title="联合查询union"></a>联合查询union</h2></li>
<li>将多条查询语句的结果合并成一个结果</li>
<li>应用场景：要查询的结果来自多个表，且多个表没有直接的连接关系，但查询的信息一致</li>
<li>多条查询语句查询列数必须一致，且每列的类型和顺序保持一致</li>
<li>union关键字默认会去重，如果不想去重，使用union all<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">查询语句1</span><br><span class="line">union</span><br><span class="line">查询语句2</span><br><span class="line">union</span><br><span class="line">查询语句3</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/">&lt;i class=&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">&lt;i class=&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="llz" />
            
              <p class="site-author-name" itemprop="name">llz</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7Carchive">
              
                  <span class="site-state-item-count">23</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">llz</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  









  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
